var rt=Object.defineProperty,at=Object.defineProperties;var ct=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var dt=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var x=(t,e,n)=>e in t?rt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,d=(t,e)=>{for(var n in e||(e={}))dt.call(e,n)&&x(t,n,e[n]);if(H)for(var n of H(e))lt.call(e,n)&&x(t,n,e[n]);return t},h=(t,e)=>at(t,ct(e));import{m as a}from"./vendor.1cb0e66f.js";const ut=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}};ut();function N(t){return b(function(){return t.map(function(e){return e()})},t)}function E(t){return t._state==="pending"||t._state==="active"||t._state==="changing"}var u=function(t){var e,n=[],o=[];function i(r){return arguments.length&&r!==u.SKIP&&(t=r,E(i)&&(i._changing(),i._state="active",n.slice().forEach(function(c,l){E(c)&&c(this[l](t))},o.slice()))),t}function s(){return(e=u()).map(function(r){return r===!0&&(i._parents.forEach(function(c){c._unregisterChild(i)}),i._state="ended",i._parents.length=n.length=o.length=0),r}),e}return i.constructor=u,i._state=arguments.length&&t!==u.SKIP?"active":"pending",i._parents=[],i._changing=function(){E(i)&&(i._state="changing"),n.forEach(function(r){r._changing()})},i._map=function(r,c){var l=c?u():u(r(t));return l._parents.push(i),n.push(l),o.push(r),l},i.map=function(r){return i._map(r,i._state!=="active")},i.toJSON=function(){return t!=null&&typeof t.toJSON=="function"?t.toJSON():t},i["fantasy-land/map"]=i.map,i["fantasy-land/ap"]=function(r){return b(function(c,l){return c()(l())},[r,i])},i._unregisterChild=function(r){var c=n.indexOf(r);c!==-1&&(n.splice(c,1),o.splice(c,1))},Object.defineProperty(i,"end",{get:function(){return e||s()}}),i};function b(t,e){var n=e.every(function(c){if(c.constructor!==u)throw new Error("Ensure that each item passed to stream.combine/stream.merge/lift is a stream.");return c._state==="active"}),o=n?u(t.apply(null,e.concat([e]))):u(),i=[],s=e.map(function(c){return c._map(function(l){return i.push(c),(n||e.every(function(g){return g._state!=="pending"}))&&(n=!0,o(t.apply(null,e.concat([i]))),i=[]),l},!0)}),r=o.end.map(function(c){c===!0&&(s.forEach(function(l){l.end(!0)}),r.end(!0))});return o}u.SKIP={},u.lift=function(){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);return N(e).map(function(n){return t.apply(void 0,n)})},u.scan=function(t,e,n){var o=n.map(function(i){var s=t(e,i);return s!==u.SKIP&&(e=s),s});return o(e),o},u.merge=N,u.combine=b,u.scanMerge=function(t,e){var n=t.map(function(i){return i[0]}),o=b(function(){var i=arguments[arguments.length-1];return n.forEach(function(s,r){i.indexOf(s)>-1&&(e=t[r][1](e,s()))}),e},n);return o(e),o},u["fantasy-land/of"]=u;var M=!1;Object.defineProperty(u,"HALT",{get:function(){return M||console.log("HALT is deprecated and has been renamed to SKIP"),M=!0,u.SKIP}});const mt=(t,e)=>e.find(n=>n.id===t),j=(t,e)=>{const n=mt(t,e);return n?e.indexOf(n):-1},ft=(t,e)=>{const n=j(t,e);return n!==-1&&e.splice(n,1),e},C=(t,e)=>[e,t.id,t.spawn].filter(Boolean).join("-"),_={initialState:{store:{}},actions:t=>({add:(e,n)=>{t(o=>{const i=o.store[e]||[];return o.store[e]=[...i,n],n.timer&&n.timer.states.map(()=>_.actions(t).refresh()),o})},remove:(e,n)=>{t(o=>{const i=o.store[e]||[],s=ft(n,i);return o.store[e]=s,o})},replace:(e,n,o)=>{t(i=>{const s=i.store[e]||[];if(s){const r=j(n,s);r!==-1&&(s[r]=o,i.store[e]=[...s])}return i})},removeAll:e=>{t(n=>(n.store[e]=[],n))},store:(e,n)=>{t(o=>(o.store[e]=[...n],o))},refresh:()=>{t(e=>d({},e))}}),selectors:t=>{const e={getStore:()=>t().store,find:(n,o)=>{const s=t().store[n]||[],r=C(o,n),c=s.find(l=>l.id===r);return c?{just:c}:{nothing:void 0}},getAll:(n,o)=>{const s=t().store[n]||[],r=o!==void 0?o.spawn:void 0,c=o!==void 0?o.id:void 0,l=r!==void 0?s.filter(p=>p.identityOptions.spawn===r):s;return c!==void 0?l.filter(p=>p.identityOptions.id===c):l},getCount:(n,o)=>e.getAll(n,o).length};return e}},R=u(),q=u.scan((t,e)=>e(t),d({},_.initialState),R),y=d({},_.actions(R)),w=d({},_.selectors(q)),O={callback:()=>{},isPaused:!1,onAbort:()=>{},onDone:()=>{},promise:void 0,remaining:void 0,startTime:void 0,timeoutFn:()=>{},timerId:void 0},gt=(t,e,n,o)=>{const i=()=>{e(),t.onDone(),o()};return d({timeoutFn:i,promise:new Promise(s=>{t.onDone=()=>s(),t.onAbort=()=>s()})},t.isPaused?{}:{startTime:new Date().getTime(),timerId:window.setTimeout(i,n),remaining:n})},I=t=>(window.clearTimeout(t.timerId),{timerId:O.timerId}),pt=t=>d({},I(t)),L=t=>h(d({},I(t)),{isPaused:!0,remaining:V(t)}),ht=(t,e)=>{window.clearTimeout(t.timerId);const n=e?Math.max(t.remaining||0,e):t.remaining;return{startTime:new Date().getTime(),isPaused:!1,remaining:n,timerId:window.setTimeout(t.timeoutFn,n)}},V=t=>t.remaining===0||t.remaining===void 0?t.remaining:t.remaining-(new Date().getTime()-(t.startTime||0)),wt=()=>{const t={initialState:O,actions:s=>({start:(r,c)=>{s(l=>d(d(d(d({},l),I(l)),gt(l,r,c,()=>t.actions(s).done())),l.isPaused&&L(l)))},stop:()=>{s(r=>d(d(d({},r),pt(r)),O))},pause:()=>{s(r=>d(d({},r),!r.isPaused&&L(r)))},resume:r=>{s(c=>d(d({},c),c.isPaused&&ht(c,r)))},abort:()=>{s(r=>(r.onAbort(),d(d({},r),I(r))))},refresh:()=>{s(r=>d({},r))},done:()=>{s(()=>O)}}),selectors:s=>({isPaused:()=>s().isPaused,getRemaining:()=>{const r=s();return r.isPaused?r.remaining:V(r)},getResultPromise:()=>s().promise})},e=u(),n=u.scan((s,r)=>r(s),d({},t.initialState),e),o=d({},t.actions(e)),i=d({},t.selectors(n));return{states:n,actions:o,selectors:i}},F=(...t)=>e=>t.filter(Boolean).reduce((n,o)=>o(n),e),B=({domElement:t,prop:e})=>{const n=document.defaultView;if(n){const o=n.getComputedStyle(t);if(o)return o.getPropertyValue(e)}},D={SHOW:"show",HIDE:"hide"},yt=(t,e)=>t.classList.remove(...e.showStart,...e.showEnd,...e.hideStart,...e.hideEnd),K=(t,e,n)=>{const o=n[e];o&&Object.keys(o).forEach(i=>{const s=o[i];t.style[i]=s})},St=t=>{t.style.transitionDuration="0ms"},vt=(t,e)=>(typeof e=="function"?e(t):e)||{},T=(t,e)=>t.split(/ /).map(n=>`${n}-${e}`),$=(t,e,n,o)=>{if(e.styles){const i=vt(t,e.styles);K(t,"default",i),o&&St(t),K(t,n,i)}if(e.className){const i={showStart:T(e.className,"show-start"),showEnd:T(e.className,"show-end"),hideStart:T(e.className,"hide-start"),hideEnd:T(e.className,"hide-end")};yt(t,i),i&&t.classList.add(...i[n])}t.scrollTop},W=t=>{const e=parseFloat(t)*(t.indexOf("ms")===-1?1e3:1);return Number.isNaN(e)?0:e},bt=t=>{const e=B({domElement:t,prop:"transition-duration"}),n=e!==void 0?W(e):0,o=B({domElement:t,prop:"transition-delay"}),i=o!==void 0?W(o):0;return n+i},_t={showStart:{nextStep:"showEnd"},showEnd:{nextStep:void 0},hideStart:{nextStep:"hideEnd"},hideEnd:{nextStep:void 0}},Ot=(t,e)=>{const{domElement:n}=t;if(!n)return Promise.resolve("no domElement");clearTimeout(t.__transitionTimeoutId__);let o=e===D.SHOW?"showStart":"hideStart";return new Promise(i=>{$(n,t,o,o==="showStart"),setTimeout(()=>{const{nextStep:s}=_t[o];if(s){o=s,$(n,t,o);const r=bt(n);t.__transitionTimeoutId__=window.setTimeout(i,r)}},0)})},P={uid:0},It=()=>(P.uid===Number.MAX_VALUE?P.uid=0:P.uid+=1,P.uid);var J;(function(t){t[t.Default=0]="Default",t[t.Displaying=1]="Displaying",t[t.Hiding=2]="Hiding"})(J||(J={}));const U=t=>e=>n=>w.find(t,Q(e,n)),G=t=>e=>t.spawn!==void 0?e.filter(n=>n.identityOptions.spawn===t.spawn):e,Tt=t=>e=>t.id!==void 0?e.filter(n=>n.identityOptions.id===t.id):e,Pt=t=>{let e=0;return t.map(n=>({item:n,queueCount:n.dialogicOptions.queued?e++:0})).filter(({queueCount:n})=>n===0).map(({item:n})=>n)},kt=(t,e,n)=>{const o=e[t]||[];return o.length===0?[]:F(G(n),Pt)(o)},Et=t=>{const e=d({},t);return delete e.dialogic,e},Q=(t,e={})=>({id:e.id||t.id,spawn:e.spawn||t.spawn}),X=(t,e={})=>{const n={id:e.dialogic?e.dialogic.id:void 0,spawn:e.dialogic?e.dialogic.spawn:void 0},o=Q(t||{},n),i=h(d(d({},t),e.dialogic),{__transitionTimeoutId__:0}),s=Et(e);return{identityOptions:o,dialogicOptions:i,passThroughOptions:s}},Dt=t=>e=>n=>{const{identityOptions:o,dialogicOptions:i,passThroughOptions:s}=X(e,n);return new Promise(r=>{const l={ns:t,identityOptions:o,dialogicOptions:i,callbacks:{willShow:f=>(i.willShow&&i.willShow(f),r(f)),willHide:f=>(i.willHide&&i.willHide(f),r(f)),didShow:f=>(i.didShow&&i.didShow(f),r(f)),didHide:f=>(i.didHide&&i.didHide(f),r(f))},passThroughOptions:s,id:C(o,t),timer:i.timeout?wt():void 0,key:It().toString(),transitionState:0},p=w.find(t,o).just;if(p&&i.toggle)return z(t)(e)(n),r(p);if(p&&!i.queued){const f=h(d({},l),{key:p.key,transitionState:p.transitionState,dialogicOptions:p.dialogicOptions});y.replace(t,p.id,f)}else y.add(t,l);r(l)})},At=Dt,z=t=>e=>n=>{const{identityOptions:o,dialogicOptions:i,passThroughOptions:s}=X(e,n),c=w.find(t,o).just;if(c){const l=h(d({},c),{dialogicOptions:d(d({},c.dialogicOptions),i),passThroughOptions:h(d({},c.passThroughOptions),{passThroughOptions:s})});return y.replace(t,c.id,l),l.transitionState!==2?v(l):Promise.resolve(l)}return Promise.resolve({ns:t,id:o.id})},Ht=t=>e=>n=>{const o=S(t,n).filter(i=>!!i.timer);return o.forEach(i=>{i.timer&&i.timer.actions.pause()}),Promise.all(o)},xt=t=>e=>n=>{const o=n||{},i={id:o.id,spawn:o.spawn},s=S(t,i).filter(r=>!!r.timer);return s.forEach(r=>{r.timer&&r.timer.actions.resume(o.minimumDuration)}),Promise.all(s)},Y=(t,e,n)=>{var i,s;const o=U(t)(e)(n);return(s=(i=o==null?void 0:o.just)==null?void 0:i.timer)==null?void 0:s.selectors},Nt=t=>e=>n=>{var o;return((o=Y(t,e,n))==null?void 0:o.isPaused())||!1},Mt=t=>e=>n=>{var o;return((o=Y(t,e,n))==null?void 0:o.getRemaining())||void 0},jt=t=>e=>n=>!!S(t,n).length,S=(t,e)=>{const n=w.getAll(t);let o;return e?o=F(G(e),Tt(e))(n):o=n,o},Ct=t=>e=>n=>{const o=S(t,n),i=[];return o.forEach(s=>{s.timer&&s.timer.actions.abort(),i.push(s)}),n?i.forEach(s=>{y.remove(t,s.id)}):y.removeAll(t),Promise.resolve(i)},Z=(t,e)=>h(d({},t),{dialogicOptions:d(d({},t.dialogicOptions),e)}),Rt=t=>e=>n=>{const o=n||{},i={id:o.id,spawn:o.spawn},s=S(t,i),r=s.filter(g=>!o.queued&&!g.dialogicOptions.queued),c=s.filter(g=>o.queued||g.dialogicOptions.queued),l=[];if(r.forEach(g=>l.push(v(Z(g,o)))),c.length>0){const[g]=c;y.store(t,[g]),l.push(v(Z(g,o)))}return Promise.all(l)},qt=t=>e=>w.getCount(t,e),tt=(t,e)=>Ot(t.dialogicOptions,e),Lt=()=>t=>e=>n=>{const o=U(t)(e)(n);if(o.just)return o.just&&o.just.timer?o.just.timer.selectors.getResultPromise():void 0},Vt=async(t,e,n)=>(e.actions.start(()=>v(t),n),Lt()),et=async t=>(t.callbacks.willShow&&t.callbacks.willShow(t),t.transitionState!==1&&(t.transitionState=1,await tt(t,D.SHOW)),t.callbacks.didShow&&t.callbacks.didShow(t),t.dialogicOptions.timeout&&t.timer&&await Vt(t,t.timer,t.dialogicOptions.timeout),Promise.resolve(t)),v=async t=>{t.transitionState=2,t.timer&&t.timer.actions.stop(),t.callbacks.willHide&&t.callbacks.willHide(t),await tt(t,D.HIDE),t.callbacks.didHide&&t.callbacks.didHide(t);const e=d({},t);return y.remove(t.ns,t.id),Promise.resolve(e)},Ft=(t,e)=>{e.dialogicOptions.domElement=t},nt=({ns:t,queued:e,timeout:n})=>{const o=`default_${t}`,i=`default_${t}`,s=d(d({id:o,spawn:i},e&&{queued:e}),n!==void 0&&{timeout:n});return{ns:t,defaultId:o,defaultSpawn:i,defaultDialogicOptions:s,show:At(t)(s),hide:z(t)(s),hideAll:Rt(t)(s),resetAll:Ct(t)(s),pause:Ht(t)(s),resume:xt(t)(s),exists:jt(t)(s),getCount:qt(t),isPaused:Nt(t)(s),getRemaining:Mt(t)(s)}},k=nt({ns:"dialog"}),m=nt({ns:"notification",queued:!0,timeout:3e3}),it=t=>{let e,n,o=!1;const i={id:t.id,spawn:t.spawn},s=()=>{const r=t.instance.getRemaining(i);e!==r&&(e=r===void 0?r:t.roundToSeconds?Math.round(Math.max(r,0)/1e3):Math.max(r,0)),t.callback(e),t.instance.exists(i)?o||(n=window.requestAnimationFrame(s)):(window.cancelAnimationFrame(n),o=!0)};n=window.requestAnimationFrame(s)},Bt=({attrs:t})=>{let e;const n=r=>{r({detail:{identityOptions:t.identityOptions,domElement:e}})},o=()=>{n(t.onMount)},i=()=>{n(t.onShow)},s=()=>{n(t.onHide)};return{oncreate:r=>{e=r.dom,o()},view:({attrs:r})=>{const c=r.dialogicOptions.component;if(!c)throw new Error("Component missing in dialogic options.");const l=r.passThroughOptions||{};return a("div",{className:r.dialogicOptions.className},a(c,h(d({},l),{show:i,hide:s})))}}},A=t=>(e,n)=>{const o=w.find(t,e.detail.identityOptions);o.just&&Ft(e.detail.domElement,o.just);const i=w.find(t,e.detail.identityOptions);i.just&&n(i.just)},Kt=t=>e=>A(t)(e,et),$t=t=>e=>A(t)(e,et),Wt=t=>e=>A(t)(e,v),Jt={view:({attrs:t})=>{const e=Kt(t.ns),n=$t(t.ns),o=Wt(t.ns),i=t.identityOptions||{};return kt(t.ns,w.getStore(),i).map(r=>a(Bt,{key:r.key,identityOptions:r.identityOptions,dialogicOptions:r.dialogicOptions,passThroughOptions:r.passThroughOptions,onMount:e,onShow:n,onHide:o}))}},ot=t=>({oncreate:({attrs:e})=>{typeof e.onMount=="function"&&e.onMount()},view:({attrs:e})=>{const n={id:e.id||t.defaultId,spawn:e.spawn||t.defaultSpawn};return a(Jt,{identityOptions:n,ns:t.ns})}}),Ut=ot(k),Gt=ot(m);q.map(t=>{a.redraw()});const Qt={view:({attrs:t})=>a(".mdc-dialog__container",a(".mdc-dialog__surface",[a("h2.mdc-dialog__title",t.title),a(".mdc-dialog__content",t.body),a("footer.mdc-dialog__actions",[a("button.mdc-button.mdc-dialog__button",{onclick:()=>{k.hide(),t.onReject()}},a("span.mdc-button__label","Resume")),a("button.mdc-button.mdc-dialog__button",{onclick:()=>{k.hide(),t.onAccept()}},a("span.mdc-button__label","Hide all"))])]))},Xt={view:({attrs:t})=>a(".mdc-dialog.mdc-dialog--open",[a(Qt,d({},t)),a(".mdc-dialog__scrim")])},zt={view:({attrs:t})=>[a(".mdc-snackbar__label",t.remainingSeconds!==void 0?`Some async process message. Retrying in ${t.remainingSeconds} seconds.`:"Some async process message."),a(".mdc-snackbar__actions",a("button.mdc-button.mdc-snackbar__action",{onclick:()=>{m.pause(),k.show({dialogic:{component:Xt,className:"dialog"},title:"About this dialog",body:"The notification is paused, so you can take your time to read this message.",onAccept:()=>{m.hide(),m.resume()},onReject:()=>{m.resume({minimumDuration:2e3})}})}},"Show options"))]},Yt=()=>{let t;return it({instance:m,roundToSeconds:!0,callback:e=>{e!==t&&(t=e,a.redraw())}}),{view:()=>a(".mdc-snackbar.mdc-snackbar--open",a(".mdc-snackbar__surface",a(zt,{remainingSeconds:t})))}},Zt=()=>{let t;return it({instance:m,roundToSeconds:!1,callback:e=>{t=e,a.redraw()}}),{view:()=>a("span",{style:{minWidth:"3em",textAlign:"left"}},t===void 0?"0":t.toString())}};const te={view:()=>[a(".page",[a("main",[a("h1","Dialogic for Mithril demo"),a(".message","Add one or more notifications, then click on the Show Options button in the message."),a(".ui.message",[a(".ui.button.primary",{onclick:()=>{m.show({dialogic:{component:Yt,className:"notification",timeout:4e3}})}},"Add notification"),a(".ui.button",{onclick:()=>{m.pause()}},"Pause"),a(".ui.button",{onclick:()=>{m.resume()}},"Resume"),a(".ui.button",{onclick:()=>{m.hideAll()}},"Hide all"),a(".ui.button",{onclick:()=>{m.resetAll()}},"Reset all")]),a(".ui.message",[a(".ui.label",["Notifications",a(".detail",m.getCount())]),a(".ui.label",["Is paused",a(".detail",m.isPaused().toString())]),m.exists()&&a(".ui.label",["Remaining",a(".detail",a(Zt))])])]),a("footer",[a("div",a.trust("Dialogic: manage dialogs and notifications. <a href='https://github.com/ArthurClemens/dialogic'>Main documentation on GitHub</a>"))])]),a(Gt),a(Ut)]},st=document.getElementById("app");st&&a.mount(st,te);
