var it=Object.defineProperty,nt=Object.defineProperties;var ot=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,at=Object.prototype.propertyIsEnumerable;var E=(t,e,i)=>e in t?it(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,r=(t,e)=>{for(var i in e||(e={}))st.call(e,i)&&E(t,i,e[i]);if(A)for(var i of A(e))at.call(e,i)&&E(t,i,e[i]);return t},p=(t,e)=>nt(t,ot(e));import{e as b,m as c}from"./vendor.c2711a62.js";const ct=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=i(o);fetch(o.href,s)}};ct();const rt=(t,e)=>e.find(i=>i.id===t),H=(t,e)=>{const i=rt(t,e);return i?e.indexOf(i):-1},dt=(t,e)=>{const i=H(t,e);return i!==-1&&e.splice(i,1),e},x=(t,e)=>[e,t.id,t.spawn].filter(Boolean).join("-"),O={initialState:{store:{}},actions:t=>({add:(e,i)=>{t(n=>{const o=n.store[e]||[];return n.store[e]=[...o,i],i.timer&&i.timer.states.map(()=>O.actions(t).refresh()),n})},remove:(e,i)=>{t(n=>{const o=n.store[e]||[],s=dt(i,o);return n.store[e]=s,n})},replace:(e,i,n)=>{t(o=>{const s=o.store[e]||[];if(s){const a=H(i,s);a!==-1&&(s[a]=n,o.store[e]=[...s])}return o})},removeAll:e=>{t(i=>(i.store[e]=[],i))},store:(e,i)=>{t(n=>(n.store[e]=[...i],n))},refresh:()=>{t(e=>r({},e))}}),selectors:t=>{const e={getStore:()=>t().store,find:(i,n)=>{const s=t().store[i]||[],a=x(n,i),l=s.find(d=>d.id===a);return l?{just:l}:{nothing:void 0}},getAll:(i,n)=>{const s=t().store[i]||[],a=n!==void 0?n.spawn:void 0,l=n!==void 0?n.id:void 0,d=a!==void 0?s.filter(g=>g.identityOptions.spawn===a):s;return l!==void 0?d.filter(g=>g.identityOptions.id===l):d},getCount:(i,n)=>e.getAll(i,n).length};return e}},N=b(),M=b.scan((t,e)=>e(t),r({},O.initialState),N),w=r({},O.actions(N)),h=r({},O.selectors(M)),I={callback:()=>{},isPaused:!1,onAbort:()=>{},onDone:()=>{},promise:void 0,remaining:void 0,startTime:void 0,timeoutFn:()=>{},timerId:void 0},lt=(t,e,i,n)=>{const o=()=>{e(),t.onDone(),n()};return r({timeoutFn:o,promise:new Promise(s=>{t.onDone=()=>s(),t.onAbort=()=>s()})},t.isPaused?{}:{startTime:new Date().getTime(),timerId:window.setTimeout(o,i),remaining:i})},v=t=>(window.clearTimeout(t.timerId),{timerId:I.timerId}),ut=t=>r({},v(t)),R=t=>p(r({},v(t)),{isPaused:!0,remaining:j(t)}),mt=(t,e)=>{window.clearTimeout(t.timerId);const i=e?Math.max(t.remaining||0,e):t.remaining;return{startTime:new Date().getTime(),isPaused:!1,remaining:i,timerId:window.setTimeout(t.timeoutFn,i)}},j=t=>t.remaining===0||t.remaining===void 0?t.remaining:t.remaining-(new Date().getTime()-(t.startTime||0)),gt=()=>{const t={initialState:I,actions:s=>({start:(a,l)=>{s(d=>r(r(r(r({},d),v(d)),lt(d,a,l,()=>t.actions(s).done())),d.isPaused&&R(d)))},stop:()=>{s(a=>r(r(r({},a),ut(a)),I))},pause:()=>{s(a=>r(r({},a),!a.isPaused&&R(a)))},resume:a=>{s(l=>r(r({},l),l.isPaused&&mt(l,a)))},abort:()=>{s(a=>(a.onAbort(),r(r({},a),v(a))))},refresh:()=>{s(a=>r({},a))},done:()=>{s(()=>I)}}),selectors:s=>({isPaused:()=>s().isPaused,getRemaining:()=>{const a=s();return a.isPaused?a.remaining:j(a)},getResultPromise:()=>s().promise})},e=b(),i=b.scan((s,a)=>a(s),r({},t.initialState),e),n=r({},t.actions(e)),o=r({},t.selectors(i));return{states:i,actions:n,selectors:o}},C=(...t)=>e=>t.filter(Boolean).reduce((i,n)=>n(i),e),q=({domElement:t,prop:e})=>{const i=document.defaultView;if(i){const n=i.getComputedStyle(t);if(n)return n.getPropertyValue(e)}},P={SHOW:"show",HIDE:"hide"},ft=(t,e)=>t.classList.remove(...e.showStart,...e.showEnd,...e.hideStart,...e.hideEnd),V=(t,e,i)=>{const n=i[e];n&&Object.keys(n).forEach(o=>{const s=n[o];t.style[o]=s})},pt=t=>{t.style.transitionDuration="0ms"},ht=(t,e)=>(typeof e=="function"?e(t):e)||{},_=(t,e)=>t.split(/ /).map(i=>`${i}-${e}`),F=(t,e,i,n)=>{if(e.styles){const o=ht(t,e.styles);V(t,"default",o),n&&pt(t),V(t,i,o)}if(e.className){const o={showStart:_(e.className,"show-start"),showEnd:_(e.className,"show-end"),hideStart:_(e.className,"hide-start"),hideEnd:_(e.className,"hide-end")};ft(t,o),o&&t.classList.add(...o[i])}t.scrollTop},L=t=>{const e=parseFloat(t)*(t.indexOf("ms")===-1?1e3:1);return Number.isNaN(e)?0:e},wt=t=>{const e=q({domElement:t,prop:"transition-duration"}),i=e!==void 0?L(e):0,n=q({domElement:t,prop:"transition-delay"}),o=n!==void 0?L(n):0;return i+o},yt={showStart:{nextStep:"showEnd"},showEnd:{nextStep:void 0},hideStart:{nextStep:"hideEnd"},hideEnd:{nextStep:void 0}},St=(t,e)=>{const{domElement:i}=t;if(!i)return Promise.resolve("no domElement");clearTimeout(t.__transitionTimeoutId__);let n=e===P.SHOW?"showStart":"hideStart";return new Promise(o=>{F(i,t,n,n==="showStart"),setTimeout(()=>{const{nextStep:s}=yt[n];if(s){n=s,F(i,t,n);const a=wt(i);t.__transitionTimeoutId__=window.setTimeout(o,a)}},0)})},T={uid:0},bt=()=>(T.uid===Number.MAX_VALUE?T.uid=0:T.uid+=1,T.uid);var B;(function(t){t[t.Default=0]="Default",t[t.Displaying=1]="Displaying",t[t.Hiding=2]="Hiding"})(B||(B={}));const $=t=>e=>i=>h.find(t,U(e,i)),W=t=>e=>t.spawn!==void 0?e.filter(i=>i.identityOptions.spawn===t.spawn):e,Ot=t=>e=>t.id!==void 0?e.filter(i=>i.identityOptions.id===t.id):e,It=t=>{let e=0;return t.map(i=>({item:i,queueCount:i.dialogicOptions.queued?e++:0})).filter(({queueCount:i})=>i===0).map(({item:i})=>i)},vt=(t,e,i)=>{const n=e[t]||[];return n.length===0?[]:C(W(i),It)(n)},_t=t=>{const e=r({},t);return delete e.dialogic,e},U=(t,e={})=>({id:e.id||t.id,spawn:e.spawn||t.spawn}),G=(t,e={})=>{const i={id:e.dialogic?e.dialogic.id:void 0,spawn:e.dialogic?e.dialogic.spawn:void 0},n=U(t||{},i),o=p(r(r({},t),e.dialogic),{__transitionTimeoutId__:0}),s=_t(e);return{identityOptions:n,dialogicOptions:o,passThroughOptions:s}},Tt=t=>e=>i=>{const{identityOptions:n,dialogicOptions:o,passThroughOptions:s}=G(e,i);return new Promise(a=>{const d={ns:t,identityOptions:n,dialogicOptions:o,callbacks:{willShow:m=>(o.willShow&&o.willShow(m),a(m)),willHide:m=>(o.willHide&&o.willHide(m),a(m)),didShow:m=>(o.didShow&&o.didShow(m),a(m)),didHide:m=>(o.didHide&&o.didHide(m),a(m))},passThroughOptions:s,id:x(n,t),timer:o.timeout?gt():void 0,key:bt().toString(),transitionState:0},g=h.find(t,n).just;if(g&&o.toggle)return K(t)(e)(i),a(g);if(g&&!o.queued){const m=p(r({},d),{key:g.key,transitionState:g.transitionState,dialogicOptions:g.dialogicOptions});w.replace(t,g.id,m)}else w.add(t,d);a(d)})},kt=Tt,K=t=>e=>i=>{const{identityOptions:n,dialogicOptions:o,passThroughOptions:s}=G(e,i),l=h.find(t,n).just;if(l){const d=p(r({},l),{dialogicOptions:r(r({},l.dialogicOptions),o),passThroughOptions:p(r({},l.passThroughOptions),{passThroughOptions:s})});return w.replace(t,l.id,d),d.transitionState!==2?S(d):Promise.resolve(d)}return Promise.resolve({ns:t,id:n.id})},Pt=t=>e=>i=>{const n=y(t,i).filter(o=>!!o.timer);return n.forEach(o=>{o.timer&&o.timer.actions.pause()}),Promise.all(n)},Dt=t=>e=>i=>{const n=i||{},o={id:n.id,spawn:n.spawn},s=y(t,o).filter(a=>!!a.timer);return s.forEach(a=>{a.timer&&a.timer.actions.resume(n.minimumDuration)}),Promise.all(s)},Q=(t,e,i)=>{var o,s;const n=$(t)(e)(i);return(s=(o=n==null?void 0:n.just)==null?void 0:o.timer)==null?void 0:s.selectors},At=t=>e=>i=>{var n;return((n=Q(t,e,i))==null?void 0:n.isPaused())||!1},Et=t=>e=>i=>{var n;return((n=Q(t,e,i))==null?void 0:n.getRemaining())||void 0},Ht=t=>e=>i=>!!y(t,i).length,y=(t,e)=>{const i=h.getAll(t);let n;return e?n=C(W(e),Ot(e))(i):n=i,n},xt=t=>e=>i=>{const n=y(t,i),o=[];return n.forEach(s=>{s.timer&&s.timer.actions.abort(),o.push(s)}),i?o.forEach(s=>{w.remove(t,s.id)}):w.removeAll(t),Promise.resolve(o)},X=(t,e)=>p(r({},t),{dialogicOptions:r(r({},t.dialogicOptions),e)}),Nt=t=>e=>i=>{const n=i||{},o={id:n.id,spawn:n.spawn},s=y(t,o),a=s.filter(f=>!n.queued&&!f.dialogicOptions.queued),l=s.filter(f=>n.queued||f.dialogicOptions.queued),d=[];if(a.forEach(f=>d.push(S(X(f,n)))),l.length>0){const[f]=l;w.store(t,[f]),d.push(S(X(f,n)))}return Promise.all(d)},Mt=t=>e=>h.getCount(t,e),z=(t,e)=>St(t.dialogicOptions,e),Rt=()=>t=>e=>i=>{const n=$(t)(e)(i);if(n.just)return n.just&&n.just.timer?n.just.timer.selectors.getResultPromise():void 0},jt=async(t,e,i)=>(e.actions.start(()=>S(t),i),Rt()),J=async t=>(t.callbacks.willShow&&t.callbacks.willShow(t),t.transitionState!==1&&(t.transitionState=1,await z(t,P.SHOW)),t.callbacks.didShow&&t.callbacks.didShow(t),t.dialogicOptions.timeout&&t.timer&&await jt(t,t.timer,t.dialogicOptions.timeout),Promise.resolve(t)),S=async t=>{t.transitionState=2,t.timer&&t.timer.actions.stop(),t.callbacks.willHide&&t.callbacks.willHide(t),await z(t,P.HIDE),t.callbacks.didHide&&t.callbacks.didHide(t);const e=r({},t);return w.remove(t.ns,t.id),Promise.resolve(e)},Ct=(t,e)=>{e.dialogicOptions.domElement=t},Y=({ns:t,queued:e,timeout:i})=>{const n=`default_${t}`,o=`default_${t}`,s=r(r({id:n,spawn:o},e&&{queued:e}),i!==void 0&&{timeout:i});return{ns:t,defaultId:n,defaultSpawn:o,defaultDialogicOptions:s,show:kt(t)(s),hide:K(t)(s),hideAll:Nt(t)(s),resetAll:xt(t)(s),pause:Pt(t)(s),resume:Dt(t)(s),exists:Ht(t)(s),getCount:Mt(t),isPaused:At(t)(s),getRemaining:Et(t)(s)}},k=Y({ns:"dialog"}),u=Y({ns:"notification",queued:!0,timeout:3e3}),Z=t=>{let e,i,n=!1;const o={id:t.id,spawn:t.spawn},s=()=>{const a=t.instance.getRemaining(o);e!==a&&(e=a===void 0?a:t.roundToSeconds?Math.round(Math.max(a,0)/1e3):Math.max(a,0)),t.callback(e),t.instance.exists(o)?n||(i=window.requestAnimationFrame(s)):(window.cancelAnimationFrame(i),n=!0)};i=window.requestAnimationFrame(s)},qt=({attrs:t})=>{let e;const i=a=>{a({detail:{identityOptions:t.identityOptions,domElement:e}})},n=()=>{i(t.onMount)},o=()=>{i(t.onShow)},s=()=>{i(t.onHide)};return{oncreate:a=>{e=a.dom,n()},view:({attrs:a})=>{const l=a.dialogicOptions.component;if(!l)throw new Error("Component missing in dialogic options.");const d=a.passThroughOptions||{};return c("div",{className:a.dialogicOptions.className},c(l,p(r({},d),{show:o,hide:s})))}}},D=t=>(e,i)=>{const n=h.find(t,e.detail.identityOptions);n.just&&Ct(e.detail.domElement,n.just);const o=h.find(t,e.detail.identityOptions);o.just&&i(o.just)},Vt=t=>e=>D(t)(e,J),Ft=t=>e=>D(t)(e,J),Lt=t=>e=>D(t)(e,S),Bt={view:({attrs:t})=>{const e=Vt(t.ns),i=Ft(t.ns),n=Lt(t.ns),o=t.identityOptions||{};return vt(t.ns,h.getStore(),o).map(a=>c(qt,{key:a.key,identityOptions:a.identityOptions,dialogicOptions:a.dialogicOptions,passThroughOptions:a.passThroughOptions,onMount:e,onShow:i,onHide:n}))}},tt=t=>({oncreate:({attrs:e})=>{typeof e.onMount=="function"&&e.onMount()},view:({attrs:e})=>{const i={id:e.id||t.defaultId,spawn:e.spawn||t.defaultSpawn};return c(Bt,{identityOptions:i,ns:t.ns})}}),$t=tt(k),Wt=tt(u);M.map(t=>{c.redraw()});const Ut={view:({attrs:t})=>c(".mdc-dialog__container",c(".mdc-dialog__surface",[c("h2.mdc-dialog__title",t.title),c(".mdc-dialog__content",t.body),c("footer.mdc-dialog__actions",[c("button.mdc-button.mdc-dialog__button",{onclick:()=>{k.hide(),t.onReject()}},c("span.mdc-button__label","Resume")),c("button.mdc-button.mdc-dialog__button",{onclick:()=>{k.hide(),t.onAccept()}},c("span.mdc-button__label","Hide all"))])]))},Gt={view:({attrs:t})=>c(".mdc-dialog.mdc-dialog--open",[c(Ut,r({},t)),c(".mdc-dialog__scrim")])},Kt={view:({attrs:t})=>[c(".mdc-snackbar__label",t.remainingSeconds!==void 0?`Some async process message. Retrying in ${t.remainingSeconds} seconds.`:"Some async process message."),c(".mdc-snackbar__actions",c("button.mdc-button.mdc-snackbar__action",{onclick:()=>{u.pause(),k.show({dialogic:{component:Gt,className:"dialog"},title:"About this dialog",body:"The notification is paused, so you can take your time to read this message.",onAccept:()=>{u.hide(),u.resume()},onReject:()=>{u.resume({minimumDuration:2e3})}})}},"Show options"))]},Qt=()=>{let t;return Z({instance:u,roundToSeconds:!0,callback:e=>{e!==t&&(t=e,c.redraw())}}),{view:()=>c(".mdc-snackbar.mdc-snackbar--open",c(".mdc-snackbar__surface",c(Kt,{remainingSeconds:t})))}},Xt=()=>{let t;return Z({instance:u,roundToSeconds:!1,callback:e=>{t=e,c.redraw()}}),{view:()=>c("span",{style:{minWidth:"3em",textAlign:"left"}},t===void 0?"0":t.toString())}},zt={view:()=>[c(".page",[c("main",[c("h1","Dialogic for Mithril demo"),c(".message","Add one or more notifications, then click on the Retry button in the message."),c(".ui.message",[c(".ui.button.primary",{onclick:()=>{u.show({dialogic:{component:Qt,className:"notification",timeout:4e3}})}},"Add notification"),c(".ui.button",{onclick:()=>{u.pause()}},"Pause"),c(".ui.button",{onclick:()=>{u.resume()}},"Resume"),c(".ui.button",{onclick:()=>{u.hideAll()}},"Hide all"),c(".ui.button",{onclick:()=>{u.resetAll()}},"Reset all")]),c(".ui.message",[c(".ui.label",["Notifications",c(".detail",u.getCount())]),c(".ui.label",["Is paused",c(".detail",u.isPaused().toString())]),u.exists()&&c(".ui.label",["Remaining",c(".detail",c(Xt))])])]),c("footer",[c("div",c.trust("Dialogic: manage dialogs and notifications. <a href='https://github.com/ArthurClemens/dialogic'>Main documentation on GitHub</a>"))])]),c(Wt),c($t)]},et=document.getElementById("app");et&&c.mount(et,zt);
