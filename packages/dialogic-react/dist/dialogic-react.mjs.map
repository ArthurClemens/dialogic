{"version":3,"file":"dialogic-react.mjs","sources":["../src/instanceEvents.ts","../src/Instance.tsx","../src/Wrapper.tsx","../src/useDialogicState.tsx","../src/Dialogical.tsx","../src/useDialogic.tsx","../src/useRemaining.ts","../src/index.ts"],"sourcesContent":["import {\n  showItem,\n  hideItem,\n  selectors,\n  setDomElement,\n  Dialogic,\n} from 'dialogic';\n\nexport const handleDispatch = (ns: string) => (\n  event: Dialogic.InstanceEvent,\n  fn: Dialogic.InitiateItemTransitionFn,\n) => {\n  // Update dispatching item:\n  const maybeItem: Dialogic.MaybeItem<unknown> = selectors.find(\n    ns,\n    event.detail.identityOptions,\n  );\n  if (maybeItem.just) {\n    setDomElement(event.detail.domElement, maybeItem.just);\n  }\n  // Find item to transition:\n  const maybeTransitioningItem: Dialogic.MaybeItem<unknown> = selectors.find(\n    ns,\n    event.detail.identityOptions,\n  );\n  if (maybeTransitioningItem.just) {\n    fn(maybeTransitioningItem.just);\n  }\n};\n\nexport const onInstanceMounted = (ns: string) => (\n  event: Dialogic.InstanceEvent,\n) => handleDispatch(ns)(event, showItem);\n\nexport const onShowInstance = (ns: string) => (event: Dialogic.InstanceEvent) =>\n  handleDispatch(ns)(event, showItem);\n\nexport const onHideInstance = (ns: string) => (event: Dialogic.InstanceEvent) =>\n  handleDispatch(ns)(event, hideItem);\n","import React, { FunctionComponent, useCallback, useRef } from 'react';\nimport { Dialogic } from 'dialogic';\n\ninterface Instance\n  extends Dialogic.DialogicalInstanceOptions<Dialogic.PassThroughOptions> {}\n\nexport const Instance: FunctionComponent<Dialogic.DialogicalInstanceOptions<\n  Dialogic.PassThroughOptions\n>> = props => {\n  const domElementRef = useRef();\n  const className = props.dialogicOptions.className;\n  const Component = props.dialogicOptions.component as FunctionComponent<\n    Dialogic.PassThroughOptions\n  >;\n  if (!Component) {\n    throw 'Component missing in dialogic options.';\n  }\n\n  const domElementCb = useCallback(node => {\n    if (node !== null) {\n      domElementRef.current = node;\n      onMount();\n    }\n  }, []);\n\n  const dispatchTransition = (\n    dispatchFn: Dialogic.DialogicalInstanceDispatchFn,\n  ) => {\n    const domElement = domElementRef.current;\n    if (domElement === undefined) {\n      return;\n    }\n    dispatchFn({\n      detail: {\n        identityOptions: props.identityOptions,\n        domElement,\n      },\n    });\n  };\n\n  const onMount = () => {\n    dispatchTransition(props.onMount);\n  };\n\n  const show = () => {\n    dispatchTransition(props.onShow);\n  };\n\n  const hide = () => {\n    dispatchTransition(props.onHide);\n  };\n\n  return (\n    <div ref={domElementCb} className={className}>\n      <Component {...props.passThroughOptions} show={show} hide={hide} />\n    </div>\n  );\n};\n","import React, { FunctionComponent } from 'react';\nimport { filterCandidates, selectors, Dialogic } from 'dialogic';\nimport {\n  onInstanceMounted,\n  onShowInstance,\n  onHideInstance,\n} from './instanceEvents';\nimport { Instance } from './Instance';\n\ninterface WrapperProps extends Dialogic.DialogicalWrapperOptions {}\n\nexport const Wrapper: FunctionComponent<WrapperProps> = props => {\n  const nsOnInstanceMounted = onInstanceMounted(props.ns);\n  const nsOnShowInstance = onShowInstance(props.ns);\n  const nsOnHideInstance = onHideInstance(props.ns);\n\n  const identityOptions: Dialogic.IdentityOptions =\n    props.identityOptions || ({} as Dialogic.IdentityOptions);\n  const filtered = filterCandidates(\n    props.ns,\n    selectors.getStore(),\n    identityOptions,\n  );\n\n  return (\n    <>\n      {filtered.map(item => (\n        <Instance\n          key={item.key}\n          identityOptions={item.identityOptions}\n          dialogicOptions={\n            item.dialogicOptions as Dialogic.DialogicOptions<\n              Dialogic.PassThroughOptions\n            >\n          }\n          passThroughOptions={\n            item.passThroughOptions as Dialogic.PassThroughOptions\n          }\n          onMount={nsOnInstanceMounted}\n          onShow={nsOnShowInstance}\n          onHide={nsOnHideInstance}\n        />\n      ))}\n    </>\n  );\n};\n","import { states, Dialogic } from 'dialogic';\nimport { useStream } from 'use-stream';\nimport { UseDialogicState } from '../index.d';\n\ntype TModel = {\n  _: Dialogic.States;\n};\n\nexport const useDialogicState: UseDialogicState = () => {\n  // Subscribe to changes\n  useStream<TModel>({\n    model: () => ({\n      _: states,\n    }),\n    defer: true,\n  });\n};\n","import React, { FunctionComponent, useEffect } from 'react';\nimport { Dialogic } from 'dialogic';\nimport { Wrapper } from './Wrapper';\nimport { useDialogicState } from './useDialogicState';\n\ntype DialogicalFn = (\n  type: Dialogic.DialogicInstance,\n) => FunctionComponent<Dialogic.ComponentOptions>;\n\nexport const Dialogical: DialogicalFn = instance => props => {\n  useDialogicState();\n\n  const identityOptions = {\n    id: props.id || instance.defaultId,\n    spawn: props.spawn || instance.defaultSpawn,\n  };\n\n  // Mount\n  useEffect(() => {\n    if (typeof props.onMount === 'function') {\n      props.onMount();\n    }\n  }, []);\n\n  return <Wrapper identityOptions={identityOptions} ns={instance.ns} />;\n};\n","import { useEffect, useState } from 'react';\nimport { dialog, notification } from 'dialogic';\nimport React, { PropsWithChildren } from 'react';\nimport {\n  UseDialogicProps,\n  UseDialogicInstanceProps,\n  sharedUseDialogic,\n  sharedUseDialog,\n  sharedUseNotification,\n} from 'dialogic-hooks';\n\nexport const useDialogic = sharedUseDialogic({ useEffect, useState });\nexport const useDialog = sharedUseDialog({ useEffect, useState, dialog });\nexport const useNotification = sharedUseNotification({\n  useEffect,\n  useState,\n  notification,\n});\n\n/**\n * Helper component that wraps `useDialogic` to use with JSX syntax.\n */\nexport const UseDialogic = <T,>(\n  props: PropsWithChildren<UseDialogicInstanceProps<T>>,\n) => {\n  useDialogic<T>(props);\n  return null;\n};\n\nexport const UseDialog = <T,>(\n  props: PropsWithChildren<UseDialogicProps<T>>,\n) => <UseDialogic {...props} instance={dialog} />;\n\nexport const UseNotification = <T,>(\n  props: PropsWithChildren<UseDialogicProps<T>>,\n) => <UseDialogic {...props} instance={notification} />;\n","import { useState, useMemo } from 'react';\n\nimport { sharedUseRemaining } from 'dialogic-hooks';\n\nexport const useRemaining = sharedUseRemaining({ useState, useMemo });\n","import { dialog, notification } from 'dialogic';\nimport { Dialogical } from './Dialogical';\n\nconst Dialog = Dialogical(dialog);\nconst Notification = Dialogical(notification);\n\nexport { Dialogical, dialog, Dialog, notification, Notification };\n\nexport * from './useDialogic';\nexport * from './useRemaining';\nexport * from './useDialogicState';\n"],"names":[],"mappings":"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"}