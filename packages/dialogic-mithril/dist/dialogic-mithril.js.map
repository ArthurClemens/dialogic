{"version":3,"file":"dialogic-mithril.js","sources":["../src/Instance.ts","../src/instanceEvents.ts","../src/Wrapper.ts","../src/Dialogical.ts","../src/useDialogic.ts","../src/index.ts","../src/useRemaining.ts"],"sourcesContent":["import { Dialogic } from 'dialogic';\nimport m, { ClosureComponent, Component } from 'mithril';\n\ntype ComponentProps = Dialogic.PassThroughOptions & {\n  show: () => void;\n  hide: () => void;\n};\n\nexport const Instance: ClosureComponent<\n  Dialogic.DialogicalInstanceOptions<Dialogic.PassThroughOptions>\n> = ({ attrs: componentAttrs }) => {\n  let domElement: HTMLElement;\n\n  const dispatchTransition = (\n    dispatchFn: Dialogic.DialogicalInstanceDispatchFn,\n  ) => {\n    dispatchFn({\n      detail: {\n        identityOptions: componentAttrs.identityOptions,\n        domElement,\n      },\n    });\n  };\n\n  const onMount = () => {\n    dispatchTransition(componentAttrs.onMount);\n  };\n\n  const show = () => {\n    dispatchTransition(componentAttrs.onShow);\n  };\n\n  const hide = () => {\n    dispatchTransition(componentAttrs.onHide);\n  };\n\n  return {\n    oncreate: (vnode: { dom: Element }) => {\n      domElement = vnode.dom as HTMLElement;\n      onMount();\n    },\n    view: ({ attrs }) => {\n      const component = attrs.dialogicOptions\n        .component as Component<ComponentProps>;\n      if (!component) {\n        throw new Error('Component missing in dialogic options.');\n      }\n      const passThroughOptions = (attrs.passThroughOptions as {}) || {};\n      return m(\n        'div',\n        { className: attrs.dialogicOptions.className },\n        m(component, {\n          ...passThroughOptions,\n          show,\n          hide,\n        }),\n      );\n    },\n  };\n};\n","import {\n  Dialogic,\n  hideItem,\n  selectors,\n  setDomElement,\n  showItem,\n} from 'dialogic';\n\nexport const handleDispatch = (ns: string) => (\n  event: Dialogic.InstanceEvent,\n  fn: Dialogic.InitiateItemTransitionFn,\n) => {\n  // Update dispatching item:\n  const maybeItem: Dialogic.MaybeItem<unknown> = selectors.find(\n    ns,\n    event.detail.identityOptions,\n  );\n  if (maybeItem.just) {\n    setDomElement(event.detail.domElement, maybeItem.just);\n  }\n  // Find item to transition:\n  const maybeTransitioningItem: Dialogic.MaybeItem<unknown> = selectors.find(\n    ns,\n    event.detail.identityOptions,\n  );\n  if (maybeTransitioningItem.just) {\n    fn(maybeTransitioningItem.just);\n  }\n};\n\nexport const onInstanceMounted = (ns: string) => (\n  event: Dialogic.InstanceEvent,\n) => handleDispatch(ns)(event, showItem);\n\nexport const onShowInstance = (ns: string) => (event: Dialogic.InstanceEvent) =>\n  handleDispatch(ns)(event, showItem);\n\nexport const onHideInstance = (ns: string) => (event: Dialogic.InstanceEvent) =>\n  handleDispatch(ns)(event, hideItem);\n","import { Dialogic, filterCandidates, selectors } from 'dialogic';\nimport m, { Component } from 'mithril';\n\nimport { Instance } from './Instance';\nimport {\n  onHideInstance,\n  onInstanceMounted,\n  onShowInstance,\n} from './instanceEvents';\n\nexport const Wrapper: Component<Dialogic.DialogicalWrapperOptions> = {\n  view: ({ attrs }) => {\n    const nsOnInstanceMounted = onInstanceMounted(attrs.ns);\n    const nsOnShowInstance = onShowInstance(attrs.ns);\n    const nsOnHideInstance = onHideInstance(attrs.ns);\n\n    const identityOptions: Dialogic.IdentityOptions =\n      attrs.identityOptions || ({} as Dialogic.IdentityOptions);\n    const filtered = filterCandidates(\n      attrs.ns,\n      selectors.getStore(),\n      identityOptions,\n    );\n\n    return filtered.map(item =>\n      m(Instance, {\n        key: item.key,\n        identityOptions: item.identityOptions,\n        dialogicOptions: item.dialogicOptions as Dialogic.DialogicOptions<Dialogic.PassThroughOptions>,\n        passThroughOptions: item.passThroughOptions as Dialogic.PassThroughOptions,\n        onMount: nsOnInstanceMounted,\n        onShow: nsOnShowInstance,\n        onHide: nsOnHideInstance,\n      }),\n    );\n  },\n};\n","import { Dialogic } from 'dialogic';\nimport m, { Component } from 'mithril';\n\nimport { Wrapper } from './Wrapper';\n\ntype DialogicalFn = (\n  type: Dialogic.DialogicInstance,\n) => Component<Dialogic.ComponentOptions>;\n\nexport const Dialogical: DialogicalFn = instance => ({\n  oncreate: ({ attrs }) => {\n    if (typeof attrs.onMount === 'function') {\n      attrs.onMount();\n    }\n  },\n  view: ({ attrs }) => {\n    const identityOptions = {\n      id: attrs.id || instance.defaultId,\n      spawn: attrs.spawn || instance.defaultSpawn,\n    };\n    return m(Wrapper, {\n      identityOptions,\n      ns: instance.ns,\n    });\n  },\n});\n","import { dialog, Dialogic, notification } from 'dialogic';\nimport type { UseDialogicInstanceProps } from 'dialogic-hooks';\nimport { useEffect, useState } from 'mithril-hooks';\n\nlet useDialogicCounter = 0;\n\nexport const useDialogic = <T>({\n  isIgnore,\n  isShow,\n  isHide,\n  instance,\n  deps = [],\n  props = {} as T & Dialogic.Options<T>,\n}: UseDialogicInstanceProps<T>) => {\n  // Create an id if not set.\n  // This is useful for pages with multiple dialogs, where we can't expect\n  // to have the user set an explicit id for each.\n  // eslint-disable-next-line no-plusplus\n  const [id] = useState(useDialogicCounter++);\n  const augProps = {\n    ...props,\n    ...(props.dialogic\n      ? {\n          dialogic: {\n            ...props.dialogic,\n            id: props.dialogic.id || id,\n          },\n        }\n      : {\n          dialogic: {\n            id,\n          },\n        }),\n  };\n\n  const showInstance = () => {\n    instance.show<T>(augProps);\n  };\n\n  const hideInstance = () => {\n    instance.hide<T>(augProps);\n  };\n\n  // maybe show\n  useEffect(() => {\n    if (isIgnore) return;\n    if (isShow !== undefined) {\n      if (isShow) {\n        showInstance();\n      } else {\n        hideInstance();\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [...deps, isShow]);\n\n  // maybe hide\n  useEffect(() => {\n    if (isIgnore) return;\n    if (isHide !== undefined) {\n      if (isHide) {\n        hideInstance();\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [...deps, isHide]);\n\n  // unmount\n  useEffect(() => {\n    if (isIgnore) return;\n    // eslint-disable-next-line consistent-return\n    return () => {\n      hideInstance();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return {\n    show: showInstance,\n    hide: hideInstance,\n  };\n};\n\nexport const useDialog = <T>(\n  props: Omit<UseDialogicInstanceProps<T>, 'instance'>,\n) => useDialogic<T>({ instance: dialog, ...props });\n\nexport const useNotification = <T>(\n  props: Omit<UseDialogicInstanceProps<T>, 'instance'>,\n) =>\n  useDialogic<T>({\n    instance: notification,\n    ...props,\n  });\n","import { dialog, Dialogic, notification, states } from 'dialogic';\nimport m from 'mithril';\n\nimport { Dialogical } from './Dialogical';\n\nconst Dialog = Dialogical(dialog);\nconst Notification = Dialogical(notification);\n\nexport { Dialog, dialog, Dialogic, Dialogical, Notification, notification };\nexport * from './useDialogic';\nexport * from './useRemaining';\n\nstates.map(\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  state => m.redraw(),\n  // console.log(JSON.stringify(state, null, 2))\n);\n","import { remaining } from 'dialogic';\nimport type { UseRemainingProps } from 'dialogic-hooks';\nimport { useMemo, useState } from 'mithril-hooks';\n\nexport const useRemaining = ({\n  instance,\n  id,\n  spawn,\n  roundToSeconds,\n}: UseRemainingProps) => {\n  const [value, setValue] = useState<number | undefined>(undefined);\n  const identity = {\n    id,\n    spawn,\n  };\n  const exists = !!instance.exists(identity);\n  useMemo(() => {\n    if (exists) {\n      remaining({\n        ...identity,\n        instance,\n        roundToSeconds,\n        callback: newValue => {\n          setValue(newValue);\n        },\n      });\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [exists]);\n\n  return [value];\n};\n"],"names":["Instance","attrs","componentAttrs","domElement","dispatchTransition","dispatchFn","detail","identityOptions","show","onShow","hide","onHide","oncreate","vnode","dom","onMount","view","component","dialogicOptions","Error","passThroughOptions","m","className","handleDispatch","ns","event","fn","maybeItem","selectors","find","just","setDomElement","maybeTransitioningItem","Wrapper","nsOnInstanceMounted","showItem","nsOnShowInstance","onShowInstance","nsOnHideInstance","hideItem","onHideInstance","filterCandidates","getStore","map","item","key","Dialogical","instance","id","defaultId","spawn","defaultSpawn","useDialogicCounter","useDialogic","isIgnore","isShow","isHide","deps","props","useState","augProps","dialogic","showInstance","hideInstance","useEffect","undefined","Dialog","dialog","Notification","notification","state","redraw","roundToSeconds","value","setValue","identity","exists","useMemo","remaining","callback","newValue"],"mappings":"mdAQO,MAAMA,EAET,EAAGC,MAAOC,MACZ,IAAIC,EAEJ,MAAMC,EACJC,IAEAA,EAAW,CACTC,OAAQ,CACNC,gBAAiBL,EAAeK,gBAChCJ,WAAAA,MASAK,EAAO,KACXJ,EAAmBF,EAAeO,SAG9BC,EAAO,KACXN,EAAmBF,EAAeS,SAGpC,MAAO,CACLC,SAAWC,IACTV,EAAaU,EAAMC,IAbrBV,EAAmBF,EAAea,UAgBlCC,KAAM,EAAGf,MAAAA,MACP,MAAMgB,EAAYhB,EAAMiB,gBACrBD,UACH,IAAKA,EACH,MAAM,IAAIE,MAAM,0CAElB,MAAMC,EAAsBnB,EAAMmB,oBAA6B,GAC/D,OAAOC,UACL,MACA,CAAEC,UAAWrB,EAAMiB,gBAAgBI,WACnCD,UAAEJ,iCACGG,IACHZ,KAAAA,EACAE,KAAAA,SC9CGa,EAAkBC,GAAe,CAC5CC,EACAC,KAGA,MAAMC,EAAyCC,YAAUC,KACvDL,EACAC,EAAMnB,OAAOC,iBAEXoB,EAAUG,MACZC,gBAAcN,EAAMnB,OAAOH,WAAYwB,EAAUG,MAGnD,MAAME,EAAsDJ,YAAUC,KACpEL,EACAC,EAAMnB,OAAOC,iBAEXyB,EAAuBF,MACzBJ,EAAGM,EAAuBF,OChBjBG,EAAwD,CACnEjB,KAAM,EAAGf,MAAAA,MACP,MAAMiC,GDkBwBV,EClBgBvB,EAAMuB,GDmBtDC,GACGF,EAAeC,EAAfD,CAAmBE,EAAOU,aAFE,IAACX,ECjB9B,MAAMY,EDqBoB,CAACZ,GAAgBC,GAC7CF,EAAeC,EAAfD,CAAmBE,EAAOU,YCtBCE,CAAepC,EAAMuB,IACxCc,EDuBoB,CAACd,GAAgBC,GAC7CF,EAAeC,EAAfD,CAAmBE,EAAOc,YCxBCC,CAAevC,EAAMuB,IAExCjB,EACJN,EAAMM,iBAAoB,GAO5B,OANiBkC,mBACfxC,EAAMuB,GACNI,YAAUc,WACVnC,GAGcoC,IAAIC,GAClBvB,UAAErB,EAAU,CACV6C,IAAKD,EAAKC,IACVtC,gBAAiBqC,EAAKrC,gBACtBW,gBAAiB0B,EAAK1B,gBACtBE,mBAAoBwB,EAAKxB,mBACzBL,QAASmB,EACTzB,OAAQ2B,EACRzB,OAAQ2B,OCvBHQ,EAA2BC,KACtCnC,SAAU,EAAGX,MAAAA,MACkB,mBAAlBA,EAAMc,SACfd,EAAMc,WAGVC,KAAM,EAAGf,MAAAA,MACP,MAAMM,EAAkB,CACtByC,GAAI/C,EAAM+C,IAAMD,EAASE,UACzBC,MAAOjD,EAAMiD,OAASH,EAASI,cAEjC,OAAO9B,UAAEY,EAAS,CAChB1B,gBAAAA,EACAiB,GAAIuB,EAASvB,QClBnB,IAAI4B,EAAqB,QAEZC,EAAc,EACzBC,SAAAA,EACAC,OAAAA,EACAC,OAAAA,EACAT,SAAAA,EACAU,KAAAA,EAAO,GACPC,MAAAA,EAAQ,OAMR,MAAOV,GAAMW,WAASP,KAChBQ,iCACDF,GACCA,EAAMG,SACN,CACEA,wCACKH,EAAMG,WACTb,GAAIU,EAAMG,SAASb,IAAMA,KAG7B,CACEa,SAAU,CACRb,GAAAA,KAKJc,EAAe,KACnBf,EAASvC,KAAQoD,IAGbG,EAAe,KACnBhB,EAASrC,KAAQkD,IAqCnB,OAjCAI,YAAU,KACJV,QACWW,IAAXV,IACEA,EACFO,IAEAC,MAIH,IAAIN,EAAMF,IAGbS,YAAU,KACJV,QACWW,IAAXT,GACEA,GACFO,KAIH,IAAIN,EAAMD,IAGbQ,YAAU,KACR,IAAIV,EAEJ,MAAO,KACLS,MAGD,IAEI,CACLvD,KAAMsD,EACNpD,KAAMqD,IC1EJG,EAASpB,EAAWqB,UACpBC,EAAetB,EAAWuB,yBAMzB1B,IAEL2B,GAASjD,UAAEkD,uUDsEXb,GACGL,iBAAiBN,SAAUoB,UAAWT,sCAGzCA,GAEAL,iBACEN,SAAUsB,gBACPX,mBExFqB,EAC1BX,SAAAA,EACAC,GAAAA,EACAE,MAAAA,EACAsB,eAAAA,MAEA,MAAOC,EAAOC,GAAYf,gBAA6BM,GACjDU,EAAW,CACf3B,GAAAA,EACAE,MAAAA,GAEI0B,IAAW7B,EAAS6B,OAAOD,GAejC,OAdAE,UAAQ,KACFD,GACFE,2CACKH,IACH5B,SAAAA,EACAyB,eAAAA,EACAO,SAAUC,IACRN,EAASM,QAKd,CAACJ,IAEG,CAACH"}