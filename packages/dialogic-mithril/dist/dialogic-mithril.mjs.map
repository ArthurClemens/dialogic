{"version":3,"file":"dialogic-mithril.mjs","sources":["../src/Instance.ts","../src/instanceEvents.ts","../src/Wrapper.ts","../src/Dialogical.ts","../src/useDialogic.ts","../src/useRemaining.ts","../src/index.ts"],"sourcesContent":["import { Dialogic } from 'dialogic';\nimport m, { ClosureComponent, Component } from 'mithril';\n\ntype ComponentProps = Dialogic.PassThroughOptions & {\n  show: () => void;\n  hide: () => void;\n};\n\nexport const Instance: ClosureComponent<\n  Dialogic.DialogicalInstanceOptions<Dialogic.PassThroughOptions>\n> = ({ attrs: componentAttrs }) => {\n  let domElement: HTMLElement;\n\n  const dispatchTransition = (\n    dispatchFn: Dialogic.DialogicalInstanceDispatchFn,\n  ) => {\n    dispatchFn({\n      detail: {\n        identityOptions: componentAttrs.identityOptions,\n        domElement,\n      },\n    });\n  };\n\n  const onMount = () => {\n    dispatchTransition(componentAttrs.onMount);\n  };\n\n  const show = () => {\n    dispatchTransition(componentAttrs.onShow);\n  };\n\n  const hide = () => {\n    dispatchTransition(componentAttrs.onHide);\n  };\n\n  return {\n    oncreate: (vnode: { dom: Element }) => {\n      domElement = vnode.dom as HTMLElement;\n      onMount();\n    },\n    view: ({ attrs }) => {\n      const component = attrs.dialogicOptions\n        .component as Component<ComponentProps>;\n      if (!component) {\n        throw new Error('Component missing in dialogic options.');\n      }\n      const passThroughOptions = (attrs.passThroughOptions as {}) || {};\n      return m(\n        'div',\n        { className: attrs.dialogicOptions.className },\n        m(component, {\n          ...passThroughOptions,\n          show,\n          hide,\n        }),\n      );\n    },\n  };\n};\n","import {\n  Dialogic,\n  hideItem,\n  selectors,\n  setDomElement,\n  showItem,\n} from 'dialogic';\n\nexport const handleDispatch = (ns: string) => (\n  event: Dialogic.InstanceEvent,\n  fn: Dialogic.InitiateItemTransitionFn,\n) => {\n  // Update dispatching item:\n  const maybeItem: Dialogic.MaybeItem<unknown> = selectors.find(\n    ns,\n    event.detail.identityOptions,\n  );\n  if (maybeItem.just) {\n    setDomElement(event.detail.domElement, maybeItem.just);\n  }\n  // Find item to transition:\n  const maybeTransitioningItem: Dialogic.MaybeItem<unknown> = selectors.find(\n    ns,\n    event.detail.identityOptions,\n  );\n  if (maybeTransitioningItem.just) {\n    fn(maybeTransitioningItem.just);\n  }\n};\n\nexport const onInstanceMounted = (ns: string) => (\n  event: Dialogic.InstanceEvent,\n) => handleDispatch(ns)(event, showItem);\n\nexport const onShowInstance = (ns: string) => (event: Dialogic.InstanceEvent) =>\n  handleDispatch(ns)(event, showItem);\n\nexport const onHideInstance = (ns: string) => (event: Dialogic.InstanceEvent) =>\n  handleDispatch(ns)(event, hideItem);\n","import { Dialogic, filterCandidates, selectors } from 'dialogic';\nimport m, { Component } from 'mithril';\n\nimport { Instance } from './Instance';\nimport {\n  onHideInstance,\n  onInstanceMounted,\n  onShowInstance,\n} from './instanceEvents';\n\nexport const Wrapper: Component<Dialogic.DialogicalWrapperOptions> = {\n  view: ({ attrs }) => {\n    const nsOnInstanceMounted = onInstanceMounted(attrs.ns);\n    const nsOnShowInstance = onShowInstance(attrs.ns);\n    const nsOnHideInstance = onHideInstance(attrs.ns);\n\n    const identityOptions: Dialogic.IdentityOptions =\n      attrs.identityOptions || ({} as Dialogic.IdentityOptions);\n    const filtered = filterCandidates(\n      attrs.ns,\n      selectors.getStore(),\n      identityOptions,\n    );\n\n    return filtered.map(item =>\n      m(Instance, {\n        key: item.key,\n        identityOptions: item.identityOptions,\n        dialogicOptions: item.dialogicOptions as Dialogic.DialogicOptions<Dialogic.PassThroughOptions>,\n        passThroughOptions: item.passThroughOptions as Dialogic.PassThroughOptions,\n        onMount: nsOnInstanceMounted,\n        onShow: nsOnShowInstance,\n        onHide: nsOnHideInstance,\n      }),\n    );\n  },\n};\n","import { Dialogic } from 'dialogic';\nimport m, { Component } from 'mithril';\n\nimport { Wrapper } from './Wrapper';\n\ntype DialogicalFn = (\n  type: Dialogic.DialogicInstance,\n) => Component<Dialogic.ComponentOptions>;\n\nexport const Dialogical: DialogicalFn = instance => ({\n  oncreate: ({ attrs }) => {\n    if (typeof attrs.onMount === 'function') {\n      attrs.onMount();\n    }\n  },\n  view: ({ attrs }) => {\n    const identityOptions = {\n      id: attrs.id || instance.defaultId,\n      spawn: attrs.spawn || instance.defaultSpawn,\n    };\n    return m(Wrapper, {\n      identityOptions,\n      ns: instance.ns,\n    });\n  },\n});\n","import { dialog, notification } from 'dialogic';\nimport { UseDialogicInstanceProps, useDialogicShared } from 'dialogic-hooks';\nimport { useEffect, useState } from 'mithril-hooks';\n\nexport const useDialogic = <T>(props: UseDialogicInstanceProps<T>) =>\n  useDialogicShared<T>({\n    ...props,\n    useEffect,\n    useState,\n  });\n\nexport const useDialog = <T>(\n  props: Omit<UseDialogicInstanceProps<T>, 'instance'>,\n) => useDialogicShared<T>({ useEffect, useState, instance: dialog, ...props });\n\nexport const useNotification = <T>(\n  props: Omit<UseDialogicInstanceProps<T>, 'instance'>,\n) =>\n  useDialogicShared<T>({\n    useEffect,\n    useState,\n    instance: notification,\n    ...props,\n  });\n","import { UseRemainingProps, useRemainingShared } from 'dialogic-hooks';\nimport { useMemo, useState } from 'mithril-hooks';\n\nexport const useRemaining = (props: UseRemainingProps) =>\n  useRemainingShared({ useState, useMemo, ...props });\n","import { dialog, Dialogic, notification, states } from 'dialogic';\nimport m from 'mithril';\n\nimport { Dialogical } from './Dialogical';\n\nconst Dialog = Dialogical(dialog);\nconst Notification = Dialogical(notification);\n\nexport { Dialog, dialog, Dialogic, Dialogical, Notification, notification };\nexport * from './useDialogic';\nexport * from './useRemaining';\n\nstates.map(\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  state => m.redraw(),\n  // console.log(JSON.stringify(state, null, 2))\n);\n"],"names":[],"mappings":"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"}