!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).dialogic={})}(this,(function(t){"use strict";const e=(...t)=>e=>t.filter(Boolean).reduce((t,e)=>e(t),e),i=({domElement:t,prop:e})=>{if(window.getComputedStyle){const i=document.defaultView;if(i){const n=i.getComputedStyle(t);if(n)return n.getPropertyValue(e)}}},n="show",o="hide",s=(t,e,i)=>{const n=i[e]||{};Object.keys(n).forEach(e=>{const i=n[e].toString();t.style[e]=i})},r=(t,e)=>t.split(/ /).map(t=>`${t}-${e}`),a=(t,e,i,n)=>{if(e.styles){const o=((t,e)=>("function"==typeof e?e(t):e)||{})(t,e.styles);s(t,"default",o),n&&(t=>t.style.transitionDuration="0ms")(t),s(t,i,o)}if(e.className){const n={showStart:r(e.className,"show-start"),showEnd:r(e.className,"show-end"),hideStart:r(e.className,"hide-start"),hideEnd:r(e.className,"hide-end")};((t,e)=>t.classList.remove(...e.showStart,...e.showEnd,...e.hideStart,...e.hideEnd))(t,n),n&&t.classList.add(...n[i])}t.scrollTop},d={showStart:{nextStep:"showEnd"},showEnd:{nextStep:void 0},hideStart:{nextStep:"hideEnd"},hideEnd:{nextStep:void 0}},u=(t,e)=>{const o=t.domElement;if(!o)return Promise.resolve("no domElement");let s=e===n?"showStart":"hideStart";return new Promise(e=>{a(o,t,s,"showStart"===s),setTimeout(()=>{const n=d[s].nextStep;if(n){a(o,t,s=n);const r=(t=>{const e=i({domElement:t,prop:"transition-duration"}),n=void 0!==e?c(e):0,o=i({domElement:t,prop:"transition-delay"});return n+(void 0!==o?c(o):0)})(o);setTimeout(e,r)}},0)})},c=t=>{const e=parseFloat(t)*(-1===t.indexOf("ms")?1e3:1);return isNaN(e)?0:e};var l=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t){!function(){i.SKIP={},i.lift=function(){var t=arguments[0];return o(Array.prototype.slice.call(arguments,1)).map((function(e){return t.apply(void 0,e)}))},i.scan=function(t,e,n){var o=n.map((function(n){var o=t(e,n);return o!==i.SKIP&&(e=o),o}));return o(e),o},i.merge=o,i.combine=n,i.scanMerge=function(t,e){var i=t.map((function(t){return t[0]})),o=n((function(){var n=arguments[arguments.length-1];return i.forEach((function(i,o){n.indexOf(i)>-1&&(e=t[o][1](e,i()))})),e}),i);return o(e),o},i["fantasy-land/of"]=i;var e=!1;function i(t){var e,o=[],r=[];function a(e){return arguments.length&&e!==i.SKIP&&(t=e,s(a)&&(a._changing(),a._state="active",o.forEach((function(e,i){e(r[i](t))})))),t}return a.constructor=i,a._state=arguments.length&&t!==i.SKIP?"active":"pending",a._parents=[],a._changing=function(){s(a)&&(a._state="changing"),o.forEach((function(t){t._changing()}))},a._map=function(e,n){var s=n?i():i(e(t));return s._parents.push(a),o.push(s),r.push(e),s},a.map=function(t){return a._map(t,"active"!==a._state)},a.toJSON=function(){return null!=t&&"function"==typeof t.toJSON?t.toJSON():t},a["fantasy-land/map"]=a.map,a["fantasy-land/ap"]=function(t){return n((function(t,e){return t()(e())}),[t,a])},a._unregisterChild=function(t){var e=o.indexOf(t);-1!==e&&(o.splice(e,1),r.splice(e,1))},Object.defineProperty(a,"end",{get:function(){return e||((e=i()).map((function(t){return!0===t&&(a._parents.forEach((function(t){t._unregisterChild(a)})),a._state="ended",a._parents.length=o.length=r.length=0),t})),e)}}),a}function n(t,e){var n=e.every((function(t){if(t.constructor!==i)throw new Error("Ensure that each item passed to stream.combine/stream.merge/lift is a stream");return"active"===t._state})),o=n?i(t.apply(null,e.concat([e]))):i(),s=[],r=e.map((function(i){return i._map((function(r){return s.push(i),(n||e.every((function(t){return"pending"!==t._state})))&&(n=!0,o(t.apply(null,e.concat([s]))),s=[]),r}),!0)})),a=o.end.map((function(t){!0===t&&(r.forEach((function(t){t.end(!0)})),a.end(!0))}));return o}function o(t){return n((function(){return t.map((function(t){return t()}))}),t)}function s(t){return"pending"===t._state||"active"===t._state||"changing"===t._state}Object.defineProperty(i,"HALT",{get:function(){return e||console.log("HALT is deprecated and has been renamed to SKIP"),e=!0,i.SKIP}}),t.exports=i}()}));const m=(t,e)=>{const i=((t,e)=>e.find(e=>e.id===t))(t,e);return e.indexOf(i)},p=(t,e)=>[e,t.id,t.spawn].filter(Boolean).join("-"),f={initialState:{store:{}},actions:t=>({add:(e,i)=>{t(n=>{const o=n.store[e]||[];return n.store[e]=[...o,i],i.timer&&i.timer.states.map(()=>f.actions(t).refresh()),n})},remove:(e,i)=>{t(t=>{const n=t.store[e]||[],o=((t,e)=>{const i=m(t,e);return-1!==i&&e.splice(i,1),e})(i,n);return t.store[e]=o,t})},replace:(e,i,n)=>{t(t=>{const o=t.store[e]||[];if(o){const s=m(i,o);-1!==s&&(o[s]=n,t.store[e]=[...o])}return t})},removeAll:e=>{t(t=>(t.store[e]=[],t))},store:(e,i)=>{t(t=>(t.store[e]=[...i],t))},refresh:()=>{t(t=>({...t}))}}),selectors:t=>{const e={getStore:()=>{return t().store},find:(e,i)=>{const n=t().store[e]||[],o=p(i,e),s=n.find(t=>t.id===o);return s?{just:s}:{nothing:void 0}},getAll:(e,i)=>{const n=t().store[e]||[],o=void 0!==i?i.spawn:void 0,s=void 0!==i?i.id:void 0,r=void 0!==o?n.filter(t=>t.identityOptions.spawn===o):n;return void 0!==s?r.filter(t=>t.identityOptions.id===s):r},getCount:(t,i)=>e.getAll(t,i).length};return e}},g=l(),h=l.scan((t,e)=>e(t),{...f.initialState},g),w={...f.actions(g)},v={...f.selectors(h)},S={callback:()=>{},isPaused:void 0,onAbort:()=>{},onDone:()=>{},promise:void 0,remaining:void 0,startTime:void 0,timeoutFn:()=>{},timerId:void 0},O=(t,e,i,n)=>{const o=()=>{e(),t.onDone(),n()};return{timeoutFn:o,promise:new Promise((e,i)=>{t.onDone=()=>e(),t.onAbort=()=>i()}),...t.isPaused?{}:{startTime:(new Date).getTime(),timerId:window.setTimeout(o,i),remaining:i}}},y=t=>(window.clearTimeout(t.timerId),{timerId:S.timerId}),P=t=>({...y(t)}),E=t=>({...y(t),isPaused:!0,remaining:T(t)}),_=(t,e)=>{window.clearTimeout(t.timerId);const i=e?Math.max(t.remaining||0,e):t.remaining;return{startTime:(new Date).getTime(),isPaused:!1,remaining:i,timerId:window.setTimeout(t.timeoutFn,i)}},T=t=>void 0===t.remaining?void 0:t.remaining-((new Date).getTime()-(t.startTime||0)),b=()=>{const t={initialState:S,actions:e=>({start:(i,n)=>{e(o=>({...o,...y(o),...O(o,i,n,()=>t.actions(e).done()),...o.isPaused&&E(o)}))},stop:()=>{e(t=>({...t,...P(t),...S}))},pause:()=>{e(t=>({...t,...!t.isPaused&&E(t)}))},resume:t=>{e(e=>({...e,...e.isPaused&&_(e,t)}))},abort:()=>{e(t=>(t.onAbort(),{...t,...y(t)}))},done:()=>{e(t=>S)},refresh:()=>{e(t=>({...t}))}}),selectors:t=>({isPaused:()=>{return t().isPaused},getRemaining:()=>{const e=t();return e.isPaused?e.remaining:T(e)},getResultPromise:()=>{return t().promise}})},e=l(),i=l.scan((t,e)=>e(t),{...t.initialState},e);return{states:i,actions:{...t.actions(e)},selectors:{...t.selectors(i)}}};let x=0;const A=()=>x===Number.MAX_SAFE_INTEGER?0:x++,I=0,j=1,N=2,q=t=>e=>void 0!==t.spawn?e.filter(e=>e.identityOptions.spawn===t.spawn):e,C=t=>{let e=0;return t.map(t=>({item:t,queueCount:t.dialogicOptions.queued?e++:0})).filter(({queueCount:t})=>0===t).map(({item:t})=>t)},D=(t,e={})=>({id:e.id||t.id,spawn:e.spawn||t.spawn}),k=(t,e={})=>{const i={id:e.dialogic?e.dialogic.id:void 0,spawn:e.dialogic?e.dialogic.spawn:void 0};return{identityOptions:D(t||{},i),dialogicOptions:{...t,...e.dialogic},passThroughOptions:(t=>{const e={...t};return delete e.dialogic,e})(e)}},H=t=>e=>(i={})=>{const{identityOptions:n,dialogicOptions:o,passThroughOptions:s}=k(e,i);return new Promise(r=>{const a={didShow:t=>(o.didShow&&o.didShow(t),r(t)),didHide:t=>(o.didHide&&o.didHide(t),r(t))},d={ns:t,identityOptions:n,dialogicOptions:o,callbacks:a,passThroughOptions:s,id:p(n,t),timer:o.timeout?b():void 0,key:A().toString(),transitionState:I},u=v.find(t,n);if(u.just&&o.toggle){const n=R(t)(e)(i);return r(n)}if(u.just&&!o.queued){const e=u.just,i=e.dialogicOptions,n={...d,transitionState:e.transitionState,dialogicOptions:i};w.replace(t,e.id,n)}else w.add(t,d);r(d)})},R=t=>e=>i=>{const{identityOptions:n,dialogicOptions:o,passThroughOptions:s}=k(e,i),r=v.find(t,n);if(r.just){const e=r.just,i={...e,dialogicOptions:{...e.dialogicOptions,...o},passThroughOptions:{...e.passThroughOptions,passThroughOptions:s}};return w.replace(t,e.id,i),i.transitionState!==N?U(i):Promise.resolve(i)}return Promise.resolve()},K=t=>e=>e=>{const i=B(t,e).filter(t=>!!t.timer);return i.forEach(t=>t.timer&&t.timer.actions.pause()),Promise.all(i)},F=t=>e=>e=>{const i=e||{},n={id:i.id,spawn:i.spawn},o=B(t,n).filter(t=>!!t.timer);return o.forEach(t=>t.timer&&t.timer.actions.resume(i.minimumDuration)),Promise.all(o)},L=t=>e=>i=>n=>{const o=(t=>e=>i=>v.find(t,D(e,i)))(e)(i)(n);return o.just&&o.just&&o.just.timer?o.just.timer.selectors[t]():void 0},M=L("isPaused"),$=L("getRemaining"),J=t=>e=>e=>!!B(t,e).length,B=(t,i)=>{const n=v.getAll(t);let o;return o=i?e(q(i),(t=>e=>void 0!==t.id?e.filter(e=>e.identityOptions.id===t.id):e)(i))(n):n},V=t=>e=>e=>{const i=B(t,e),n=[];return i.forEach(t=>{t.timer&&t.timer.actions.abort(),n.push(t)}),e?n.forEach(e=>{w.remove(t,e.id)}):w.removeAll(t),Promise.resolve(n)},G=(t,e)=>({...t,dialogicOptions:{...t.dialogicOptions,...e}}),X=t=>e=>e=>{const i=e||{},n={id:i.id,spawn:i.spawn},o=B(t,n),s=o.filter(t=>!i.queued&&!t.dialogicOptions.queued),r=o.filter(t=>i.queued||t.dialogicOptions.queued),a=[];if(s.forEach(t=>a.push(U(G(t,i)))),r.length>0){const[e]=r;w.store(t,[e]),a.push(U(G(e,i)))}return Promise.all(a)},z=t=>e=>v.getCount(t,e),Q=(t,e)=>u(t.dialogicOptions,e),U=async function(t){t.transitionState=N,t.timer&&t.timer.actions.stop(),await Q(t,o),t.callbacks.didHide&&await t.callbacks.didHide(t);const e={...t};return w.remove(t.ns,t.id),Promise.resolve(e)},W=({ns:t,queued:e,timeout:i})=>{const n=`default_${t}`,o=`default_${t}`,s={id:n,spawn:o,...e&&{queued:e},...void 0!==i&&{timeout:i}};return{ns:t,defaultId:n,defaultSpawn:o,defaultDialogicOptions:s,show:H(t)(s),hide:R(t)(s),hideAll:X(t)(s),resetAll:V(t)(s),pause:K(t)(s),resume:F(t)(s),exists:J(t)(s),getCount:z(t),isPaused:M(t)(s),getRemaining:$(t)(s)}},Y=W({ns:"dialog"}),Z=W({ns:"notification",queued:!0,timeout:3e3});t.actions=w,t.dialog=Y,t.dialogical=W,t.exists=J,t.filterCandidates=(t,i,n)=>{const o=i[t]||[];return 0==o.length?[]:e(q(n),C)(o)},t.getCount=z,t.getRemaining=$,t.getTimerProperty=L,t.hide=R,t.hideAll=X,t.hideItem=U,t.isPaused=M,t.notification=Z,t.pause=K,t.resetAll=V,t.resume=F,t.selectors=v,t.setDomElement=(t,e)=>{e.dialogicOptions.domElement=t},t.show=H,t.showItem=async function(t){return t.transitionState!==j&&(t.transitionState=j,await Q(t,n)),t.callbacks.didShow&&await t.callbacks.didShow(t),t.dialogicOptions.timeout&&t.timer&&await async function(t,e,i){return e.actions.start(()=>U(t),i),L("getResultPromise")}(t,t.timer,t.dialogicOptions.timeout),Promise.resolve(t)},t.states=h,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=dialogic.js.map
