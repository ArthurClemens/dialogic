!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("mithril/stream")):"function"==typeof define&&define.amd?define(["exports","mithril/stream"],t):t((n="undefined"!=typeof globalThis?globalThis:n||self).dialogic={},n.Stream)}(this,(function(n,t){"use strict";function i(n){return n&&"object"==typeof n&&"default"in n?n:{default:n}}var e=i(t),r=function(){return(r=Object.assign||function(n){for(var t,i=1,e=arguments.length;i<e;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}).apply(this,arguments)};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function o(n,t,i,e){return new(i||(i=Promise))((function(r,o){function u(n){try{s(e.next(n))}catch(n){o(n)}}function a(n){try{s(e.throw(n))}catch(n){o(n)}}function s(n){var t;n.done?r(n.value):(t=n.value,t instanceof i?t:new i((function(n){n(t)}))).then(u,a)}s((e=e.apply(n,t||[])).next())}))}function u(n,t){var i,e,r,o,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,e&&(r=2&o[0]?e.return:o[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,o[1])).done)return r;switch(e=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,e=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(r=u.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){u.label=o[1];break}if(6===o[0]&&u.label<r[1]){u.label=r[1],r=o;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(o);break}r[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(n,u)}catch(n){o=[6,n],e=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function a(){for(var n=0,t=0,i=arguments.length;t<i;t++)n+=arguments[t].length;var e=Array(n),r=0;for(t=0;t<i;t++)for(var o=arguments[t],u=0,a=o.length;u<a;u++,r++)e[r]=o[u];return e}var s=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return function(t){return n.filter(Boolean).reduce((function(n,t){return t(n)}),t)}},c=function(n){var t=n.domElement,i=n.prop,e=document.defaultView;if(e){var r=e.getComputedStyle(t);if(r)return r.getPropertyValue(i)}},f="show",d="hide",l=function(n,t,i){var e=i[t]||{};Object.keys(e).forEach((function(t){var i=e[t].toString();n.style[t]=i}))},m=function(n,t){return n.split(/ /).map((function(n){return n+"-"+t}))},p=function(n,t,i,e){var r;if(t.styles){var o=function(n,t){return("function"==typeof t?t(n):t)||{}}(n,t.styles);l(n,"default",o),e&&function(n){n.style.transitionDuration="0ms"}(n),l(n,i,o)}if(t.className){var u={showStart:m(t.className,"show-start"),showEnd:m(t.className,"show-end"),hideStart:m(t.className,"hide-start"),hideEnd:m(t.className,"hide-end")};!function(n,t){var i;(i=n.classList).remove.apply(i,a(t.showStart,t.showEnd,t.hideStart,t.hideEnd))}(n,u),u&&(r=n.classList).add.apply(r,u[i])}n.scrollTop},v={showStart:{nextStep:"showEnd"},showEnd:{nextStep:void 0},hideStart:{nextStep:"hideEnd"},hideEnd:{nextStep:void 0}},h=function(n,t){var i=n.domElement;if(!i)return Promise.resolve("no domElement");clearTimeout(n.__transitionTimeoutId__);var e=t===f?"showStart":"hideStart";return new Promise((function(t){p(i,n,e,"showStart"===e),setTimeout((function(){var r=v[e].nextStep;if(r){p(i,n,e=r);var o=function(n){var t=c({domElement:n,prop:"transition-duration"}),i=void 0!==t?g(t):0,e=c({domElement:n,prop:"transition-delay"});return i+(void 0!==e?g(e):0)}(i);n.__transitionTimeoutId__=setTimeout(t,o)}}),0)}))},g=function(n){var t=parseFloat(n)*(-1===n.indexOf("ms")?1e3:1);return isNaN(t)?0:t},w=function(n,t){var i=function(n,t){return t.find((function(t){return t.id===n}))}(n,t);return t.indexOf(i)},y=function(n,t){return[t,n.id,n.spawn].filter(Boolean).join("-")},S={initialState:{store:{}},actions:function(n){return{add:function(t,i){n((function(e){var r=e.store[t]||[];return e.store[t]=a(r,[i]),i.timer&&i.timer.states.map((function(){return S.actions(n).refresh()})),e}))},remove:function(t,i){n((function(n){var e=n.store[t]||[],r=function(n,t){var i=w(n,t);return-1!==i&&t.splice(i,1),t}(i,e);return n.store[t]=r,n}))},replace:function(t,i,e){n((function(n){var r=n.store[t]||[];if(r){var o=w(i,r);-1!==o&&(r[o]=e,n.store[t]=a(r))}return n}))},removeAll:function(t){n((function(n){return n.store[t]=[],n}))},store:function(t,i){n((function(n){return n.store[t]=a(i),n}))},refresh:function(){n((function(n){return r({},n)}))}}},selectors:function(n){var t={getStore:function(){return n().store},find:function(t,i){var e=n().store[t]||[],r=y(i,t),o=e.find((function(n){return n.id===r}));return o?{just:o}:{nothing:void 0}},getAll:function(t,i){var e=n().store[t]||[],r=void 0!==i?i.spawn:void 0,o=void 0!==i?i.id:void 0,u=void 0!==r?e.filter((function(n){return n.identityOptions.spawn===r})):e;return void 0!==o?u.filter((function(n){return n.identityOptions.id===o})):u},getCount:function(n,i){return t.getAll(n,i).length}};return t}},b=e.default(),O=e.default.scan((function(n,t){return t(n)}),r({},S.initialState),b),P=r({},S.actions(b)),T=r({},S.selectors(O)),E={callback:function(){},isPaused:!1,onAbort:function(){},onDone:function(){},promise:void 0,remaining:void 0,startTime:void 0,timeoutFn:function(){},timerId:void 0},x=function(n){return window.clearTimeout(n.timerId),{timerId:E.timerId}},k=function(n){return r(r({},x(n)),{isPaused:!0,remaining:A(n)})},A=function(n){return 0===n.remaining||void 0===n.remaining?n.remaining:n.remaining-((new Date).getTime()-(n.startTime||0))},j=function(){var n={initialState:E,actions:function(t){return{start:function(i,e){t((function(o){return r(r(r(r({},o),x(o)),function(n,t,i,e){var o=function(){t(),n.onDone(),e()};return r({timeoutFn:o,promise:new Promise((function(t,i){n.onDone=function(){return t()},n.onAbort=function(){return t()}}))},n.isPaused?{}:{startTime:(new Date).getTime(),timerId:window.setTimeout(o,i),remaining:i})}(o,i,e,(function(){return n.actions(t).done()}))),o.isPaused&&k(o))}))},stop:function(){t((function(n){return r(r(r({},n),function(n){return r({},x(n))}(n)),E)}))},pause:function(){t((function(n){return r(r({},n),!n.isPaused&&k(n))}))},resume:function(n){t((function(t){return r(r({},t),t.isPaused&&function(n,t){window.clearTimeout(n.timerId);var i=t?Math.max(n.remaining||0,t):n.remaining;return{startTime:(new Date).getTime(),isPaused:!1,remaining:i,timerId:window.setTimeout(n.timeoutFn,i)}}(t,n))}))},abort:function(){t((function(n){return n.onAbort(),r(r({},n),x(n))}))},done:function(){t((function(n){return E}))},refresh:function(){t((function(n){return r({},n)}))}}},selectors:function(n){return{isPaused:function(){return n().isPaused},getRemaining:function(){var t=n();return t.isPaused?t.remaining:A(t)},getResultPromise:function(){return n().promise}}}},t=e.default(),i=e.default.scan((function(n,t){return t(n)}),r({},n.initialState),t);return{states:i,actions:r({},n.actions(t)),selectors:r({},n.selectors(i))}},_=0,q=0,I=1,D=2,H=function(n){return function(t){return void 0!==n.spawn?t.filter((function(t){return t.identityOptions.spawn===n.spawn})):t}},C=function(n){var t=0;return n.map((function(n){return{item:n,queueCount:n.dialogicOptions.queued?t++:0}})).filter((function(n){return 0===n.queueCount})).map((function(n){return n.item}))},N=function(n,t){return void 0===t&&(t={}),{id:t.id||n.id,spawn:t.spawn||n.spawn}},F=function(n,t){void 0===t&&(t={});var i={id:t.dialogic?t.dialogic.id:void 0,spawn:t.dialogic?t.dialogic.spawn:void 0};return{identityOptions:N(n||{},i),dialogicOptions:r(r(r({},n),t.dialogic),{__transitionTimeoutId__:0}),passThroughOptions:function(n){var t=r({},n);return delete t.dialogic,t}(t)}},R=function(n){return function(t){return function(i){void 0===i&&(i={});var e=F(t,i),o=e.identityOptions,u=e.dialogicOptions,a=e.passThroughOptions;return new Promise((function(e){var s={willShow:function(n){return u.willShow&&u.willShow(n),e(n)},willHide:function(n){return u.willHide&&u.willHide(n),e(n)},didShow:function(n){return u.didShow&&u.didShow(n),e(n)},didHide:function(n){return u.didHide&&u.didHide(n),e(n)}},c={ns:n,identityOptions:o,dialogicOptions:u,callbacks:s,passThroughOptions:a,id:y(o,n),timer:u.timeout?j():void 0,key:(_===Number.MAX_VALUE?0:_++).toString(),transitionState:q},f=T.find(n,o);if(f.just&&u.toggle){var d=M(n)(t)(i);return e(d)}if(f.just&&!u.queued){var l=f.just,m=l.dialogicOptions,p=r(r({},c),{key:l.key,transitionState:l.transitionState,dialogicOptions:m});P.replace(n,l.id,p)}else P.add(n,c);e(c)}))}}},M=function(n){return function(t){return function(i){var e=F(t,i),o=e.identityOptions,u=e.dialogicOptions,a=e.passThroughOptions,s=T.find(n,o);if(s.just){var c=s.just,f=r(r({},c),{dialogicOptions:r(r({},c.dialogicOptions),u),passThroughOptions:r(r({},c.passThroughOptions),{passThroughOptions:a})});return P.replace(n,c.id,f),f.transitionState!==D?$(f):Promise.resolve(f)}return Promise.resolve()}}},L=function(n){return function(t){return function(t){var i=z(n,t).filter((function(n){return!!n.timer}));return i.forEach((function(n){return n.timer&&n.timer.actions.pause()})),Promise.all(i)}}},V=function(n){return function(t){return function(t){var i=t||{},e={id:i.id,spawn:i.spawn},r=z(n,e).filter((function(n){return!!n.timer}));return r.forEach((function(n){return n.timer&&n.timer.actions.resume(i.minimumDuration)})),Promise.all(r)}}},B=function(n,t){return function(i){return function(e){return function(r){var o=function(n){return function(t){return function(i){return T.find(n,N(t,i))}}}(i)(e)(r);return o.just&&o.just&&o.just.timer?o.just.timer.selectors[n]():t}}}},G=B("isPaused",!1),U=B("getRemaining",void 0),X=function(n){return function(t){return function(t){return!!z(n,t).length}}},z=function(n,t){var i=T.getAll(n);return t?s(H(t),function(n){return function(t){return void 0!==n.id?t.filter((function(t){return t.identityOptions.id===n.id})):t}}(t))(i):i},J=function(n){return function(t){return function(t){var i=z(n,t),e=[];return i.forEach((function(n){n.timer&&n.timer.actions.abort(),e.push(n)})),t?e.forEach((function(t){P.remove(n,t.id)})):P.removeAll(n),Promise.resolve(e)}}},K=function(n,t){return r(r({},n),{dialogicOptions:r(r({},n.dialogicOptions),t)})},Q=function(n){return function(t){return function(t){var i=t||{},e={id:i.id,spawn:i.spawn},r=z(n,e),o=r.filter((function(n){return!i.queued&&!n.dialogicOptions.queued})),u=r.filter((function(n){return i.queued||n.dialogicOptions.queued})),a=[];if(o.forEach((function(n){return a.push($(K(n,i)))})),u.length>0){var s=u[0];P.store(n,[s]),a.push($(K(s,i)))}return Promise.all(a)}}},W=function(n){return function(t){return T.getCount(n,t)}},Y=function(n,t){return h(n.dialogicOptions,t)},Z=function(n,t,i){return o(this,void 0,void 0,(function(){return u(this,(function(e){return t.actions.start((function(){return $(n)}),i),[2,B("getResultPromise",void 0)]}))}))},$=function(n){return o(this,void 0,void 0,(function(){var t;return u(this,(function(i){switch(i.label){case 0:return n.transitionState=D,n.timer&&n.timer.actions.stop(),n.callbacks.willHide&&n.callbacks.willHide(n),[4,Y(n,d)];case 1:return i.sent(),n.callbacks.didHide&&n.callbacks.didHide(n),t=r({},n),P.remove(n.ns,n.id),[2,Promise.resolve(t)]}}))}))},nn=function(n){var t=n.ns,i=n.queued,e=n.timeout,o="default_"+t,u="default_"+t,a=r(r({id:o,spawn:u},i&&{queued:i}),void 0!==e&&{timeout:e});return{ns:t,defaultId:o,defaultSpawn:u,defaultDialogicOptions:a,show:R(t)(a),hide:M(t)(a),hideAll:Q(t)(a),resetAll:J(t)(a),pause:L(t)(a),resume:V(t)(a),exists:X(t)(a),getCount:W(t),isPaused:G(t)(a),getRemaining:U(t)(a)}},tn=nn({ns:"dialog"}),en=nn({ns:"notification",queued:!0,timeout:3e3});n.actions=P,n.dialog=tn,n.dialogical=nn,n.exists=X,n.filterCandidates=function(n,t,i){var e=t[n]||[];return 0==e.length?[]:s(H(i),C)(e)},n.getCount=W,n.getRemaining=U,n.getTimerProperty=B,n.hide=M,n.hideAll=Q,n.hideItem=$,n.isPaused=G,n.notification=en,n.pause=L,n.remaining=function(n){var t,i=void 0,e=!1,r=function(){var o=n.instance.getRemaining();i!==o&&(i=void 0===o?o:n.roundToSeconds?Math.round(Math.max(o,0)/1e3):Math.max(o,0)),n.callback(i),n.instance.exists()?e||(t=window.requestAnimationFrame(r)):(window.cancelAnimationFrame(t),e=!0)};t=window.requestAnimationFrame(r)},n.resetAll=J,n.resume=V,n.selectors=T,n.setDomElement=function(n,t){t.dialogicOptions.domElement=n},n.show=R,n.showItem=function(n){return o(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return n.callbacks.willShow&&n.callbacks.willShow(n),n.transitionState===I?[3,2]:(n.transitionState=I,[4,Y(n,f)]);case 1:t.sent(),t.label=2;case 2:return n.callbacks.didShow&&n.callbacks.didShow(n),n.dialogicOptions.timeout&&n.timer?[4,Z(n,n.timer,n.dialogicOptions.timeout)]:[3,4];case 3:t.sent(),t.label=4;case 4:return[2,Promise.resolve(n)]}}))}))},n.states=O,Object.defineProperty(n,"__esModule",{value:!0})}));
