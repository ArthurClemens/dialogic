!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).dialogic={})}(this,function(t){"use strict";const e=({domElement:t,prop:e})=>{if(window.getComputedStyle){const n=document.defaultView;if(n){const i=n.getComputedStyle(t);if(i)return i.getPropertyValue(e)}}},n="show",i="hide",o={component:!0,didHide:!0,didShow:!0,timeout:!0,transitionClassName:!0,transitionStyles:!0},s=(t,e)=>t.classList.remove(e.enter,e.enterActive,e.exit,e.exitActive),r=(t,e,n)=>{const i=n[e];i&&Object.keys(i).forEach(e=>{t.style[e]=i[e]})},a=t=>{const e=parseFloat(t)*(-1===t.indexOf("ms")?1e3:1);return isNaN(e)?0:e};var u=function(t,e){return t(e={exports:{}},e.exports),e.exports}(function(t){!function(){n.SKIP={},n.lift=function(){var t=arguments[0];return o(Array.prototype.slice.call(arguments,1)).map(function(e){return t.apply(void 0,e)})},n.scan=function(t,e,i){var o=i.map(function(i){var o=t(e,i);return o!==n.SKIP&&(e=o),o});return o(e),o},n.merge=o,n.combine=i,n.scanMerge=function(t,e){var n=t.map(function(t){return t[0]}),o=i(function(){var i=arguments[arguments.length-1];return n.forEach(function(n,o){i.indexOf(n)>-1&&(e=t[o][1](e,n()))}),e},n);return o(e),o},n["fantasy-land/of"]=n;var e=!1;function n(t){var e,o=[],r=[];function a(e){return arguments.length&&e!==n.SKIP&&(t=e,s(a)&&(a._changing(),a._state="active",o.forEach(function(e,n){e(r[n](t))}))),t}return a.constructor=n,a._state=arguments.length&&t!==n.SKIP?"active":"pending",a._parents=[],a._changing=function(){s(a)&&(a._state="changing"),o.forEach(function(t){t._changing()})},a._map=function(e,i){var s=i?n():n(e(t));return s._parents.push(a),o.push(s),r.push(e),s},a.map=function(t){return a._map(t,"active"!==a._state)},a.toJSON=function(){return null!=t&&"function"==typeof t.toJSON?t.toJSON():t},a["fantasy-land/map"]=a.map,a["fantasy-land/ap"]=function(t){return i(function(t,e){return t()(e())},[t,a])},a._unregisterChild=function(t){var e=o.indexOf(t);-1!==e&&(o.splice(e,1),r.splice(e,1))},Object.defineProperty(a,"end",{get:function(){return e||((e=n()).map(function(t){return!0===t&&(a._parents.forEach(function(t){t._unregisterChild(a)}),a._state="ended",a._parents.length=o.length=r.length=0),t}),e)}}),a}function i(t,e){var i=e.every(function(t){if(t.constructor!==n)throw new Error("Ensure that each item passed to stream.combine/stream.merge/lift is a stream");return"active"===t._state}),o=i?n(t.apply(null,e.concat([e]))):n(),s=[],r=e.map(function(n){return n._map(function(r){return s.push(n),(i||e.every(function(t){return"pending"!==t._state}))&&(i=!0,o(t.apply(null,e.concat([s]))),s=[]),r},!0)}),a=o.end.map(function(t){!0===t&&(r.forEach(function(t){t.end(!0)}),a.end(!0))});return o}function o(t){return i(function(){return t.map(function(t){return t()})},t)}function s(t){return"pending"===t._state||"active"===t._state||"changing"===t._state}Object.defineProperty(n,"HALT",{get:function(){return e||console.log("HALT is deprecated and has been renamed to SKIP"),e=!0,n.SKIP}}),t.exports=n}()});const c=(t,e)=>{const n=((t,e)=>e.find(e=>e.id===t))(t,e);return e.indexOf(n)},d=(t,e)=>[e,t.id,t.spawn].filter(Boolean).join("-"),m={initialState:{store:{}},actions:t=>({add:(e,n)=>{t(i=>{const o=i.store[e]||[];return i.store[e]=[...o,n],n.timer&&n.timer.states.map(()=>m.actions(t).refresh()),i})},remove:(e,n)=>{t(t=>{const i=t.store[e]||[],o=((t,e)=>{const n=c(t,e);return-1!==n&&e.splice(n,1),e})(n,i);return t.store[e]=o,t})},replace:(e,n,i)=>{t(t=>{const o=t.store[e]||[];if(o){const s=c(n,o);-1!==s&&(o[s]=i,t.store[e]=[...o])}return t})},removeAll:e=>{t(t=>(t.store[e]=[],t))},store:(e,n)=>{t(t=>(t.store[e]=[...n],t))},refresh:()=>{t(t=>({...t}))}}),selectors:t=>{const e={getStore:()=>{return t().store},find:(e,n)=>{const i=t().store[e]||[],o=d(n,e),s=i.find(t=>t.id===o);return s?{just:s}:{nothing:void 0}},getAll:(e,n)=>{const i=t().store[e]||[],o=void 0!==n?n.spawn:void 0,s=void 0!==n?n.id:void 0,r=void 0!==o?i.filter(t=>t.spawnOptions.spawn===o):i;return void 0!==s?r.filter(t=>t.spawnOptions.id===s):r},getCount:(t,n)=>e.getAll(t,n).length};return e}},l=u(),p=u.scan((t,e)=>e(t),{...m.initialState},l),f={...m.actions(l)},g={...m.selectors(p)},v={timerId:void 0,isPaused:void 0,remaining:void 0,startTime:void 0,callback:()=>{},timeoutFn:()=>{},promise:void 0,onDone:()=>{},onAbort:()=>{}},h=(t,e,n,i)=>{const o=()=>{e(),t.onDone(),i()};return{timeoutFn:o,promise:new Promise((e,n)=>{t.onDone=()=>e(),t.onAbort=()=>n()}),...t.isPaused?{}:{startTime:(new Date).getTime(),timerId:window.setTimeout(o,n),remaining:n}}},w=t=>(window.clearTimeout(t.timerId),{timerId:v.timerId}),O=t=>({...w(t)}),S=t=>({...w(t),isPaused:!0,remaining:P(t)}),y=(t,e)=>{window.clearTimeout(t.timerId);const n=e?Math.max(t.remaining||0,e):t.remaining;return{startTime:(new Date).getTime(),isPaused:!1,remaining:n,timerId:window.setTimeout(t.timeoutFn,n)}},P=t=>void 0===t.remaining?void 0:t.remaining-((new Date).getTime()-(t.startTime||0)),_=()=>{const t={initialState:v,actions:e=>({start:(n,i)=>{e(o=>({...o,...w(o),...h(o,n,i,()=>t.actions(e).done()),...o.isPaused&&S(o)}))},stop:()=>{e(t=>({...t,...O(t),...v}))},pause:()=>{e(t=>({...t,...S(t)}))},resume:t=>{e(e=>({...e,...e.isPaused&&y(e,t)}))},abort:()=>{e(t=>(t.onAbort(),{...t,...w(t)}))},done:()=>{e(t=>v)},refresh:()=>{e(t=>({...t}))}}),selectors:t=>({isPaused:()=>{return t().isPaused},getRemaining:()=>{const e=t();return e.isPaused?e.remaining:P(e)},getResultPromise:()=>{return t().promise}})},e=u(),n=u.scan((t,e)=>e(t),{...t.initialState},e);return{states:n,actions:{...t.actions(e)},selectors:{...t.selectors(n)}}};let A=0;const x=()=>A===Number.MAX_SAFE_INTEGER?0:A++,T="none",E="hiding",j=t=>{let e=0;return t.map(t=>({item:t,queueCount:t.spawnOptions.queued?e++:0})).filter(({queueCount:t})=>0===t).map(({item:t})=>t)},I=t=>{return Object.keys(t).reduce((e,n)=>{const i=t[n];return o[n]?e.transitionOptions[n]=i:e.instanceOptions[n]=i,e},{transitionOptions:{},instanceOptions:{}})},C=t=>e=>n=>(i={},o)=>new Promise(s=>{const r={...e,...o},a=d(r,t),{transitionOptions:u,instanceOptions:c}=I(i),m={...n,...u};m.didShow=t=>(i.didShow&&i.didShow(t),s(t)),m.didHide=t=>(i.didHide&&i.didHide(t),s(t));const l=x().toString(),p={ns:t,spawnOptions:r,transitionOptions:m,instanceTransitionOptions:u,instanceOptions:c,id:a,timer:m.timeout?_():void 0,key:l,transitionState:T},v=g.find(t,r);if(v.just&&!r.queued){const e=v.just,n=e.instanceTransitionOptions,i={...p,instanceTransitionOptions:n};f.replace(t,e.id,i),m.didShow(p)}else f.add(t,p);s(p)}),b=t=>e=>n=>(i,o)=>{return N(t)(e)(o).just?D(t)(e)(o):C(t)(e)(n)(i,o)},N=t=>e=>n=>{const i={...e,...n};return g.find(t,i)},q=t=>e=>n=>(i,o)=>{const s=N(e)(n)(i);return s.just?t(e,s.just,o):Promise.resolve()},D=q((t,e)=>e.transitionState!==E?(e.transitionState=E,G(e)):Promise.resolve(e)),H=q((t,e)=>(e&&e.timer&&e.timer.actions.pause(),Promise.resolve(e))),L=q((t,e,n={})=>(e&&e.timer&&e.timer.actions.resume(n.minimumDuration),Promise.resolve(e))),R=t=>e=>n=>i=>{const o=N(e)(n)(i);return o.just&&o.just&&o.just.timer?o.just.timer.selectors[t]():void 0},K=R("isPaused"),$=R("getRemaining"),F=t=>e=>n=>{return!!N(t)(e)(n).just},J=t=>()=>(g.getAll(t).forEach(t=>t.timer&&t.timer.actions.abort()),f.removeAll(t),Promise.resolve()),k=(t,e)=>{const{transitionOptions:n}=I(e);return{...t,transitionOptions:{...t.transitionOptions,...n}}},M=t=>e=>(n,i)=>{const o={...e,...i},s=g.getAll(t),r=s.filter(t=>!o.queued&&!t.spawnOptions.queued),a=s.filter(t=>o.queued||t.spawnOptions.queued);if(r.forEach(t=>G(k(t,n))),a.length>0){const[e]=a;f.store(t,[e]),G(k(e,n)).then(()=>f.removeAll(t))}},B=t=>e=>g.getCount(t,e),V=(t,i)=>((t,i)=>{const o=t.domElement;return o?new Promise(u=>{const c={isShow:i===n,name:i===n?"enter":"exit"};t.transitionStyles&&(r(o,"default",t.transitionStyles),r(o,c.name,t.transitionStyles));const d=t.transitionClassName?{enter:`${t.transitionClassName}-enter`,enterActive:`${t.transitionClassName}-enter-active`,exit:`${t.transitionClassName}-exit`,exitActive:`${t.transitionClassName}-exit-active`}:void 0;o.scrollTop;const m=()=>{o.removeEventListener("transitionend",m,!1),u()};o.addEventListener("transitionend",m,!1),d&&(s(o,d),o.classList.add(c.isShow?d.enter:d.exit),o.scrollTop),c.isShow&&o.scrollTop,c.name=c.isShow?"enterActive":"exitActive",t.transitionStyles&&(r(o,"default",t.transitionStyles),r(o,c.name,t.transitionStyles)),d&&(s(o,d),o.classList.add(c.isShow?d.enterActive:d.exitActive));const l=e({domElement:o,prop:"transition-duration"}),p=void 0!==l?a(l):0,f=e({domElement:o,prop:"transition-delay"}),g=p+(void 0!==f?a(f):0);0==g&&setTimeout(m,g)}):Promise.resolve("no domElement")})({...t.instanceTransitionOptions,...t.transitionOptions},i),G=async function(t){t.timer&&t.timer.actions.stop(),await V(t,i),t.transitionOptions.didHide&&await t.transitionOptions.didHide(t);const e=JSON.parse(JSON.stringify(t));return f.remove(t.ns,t.id),Promise.resolve(e)},X=({ns:t,queued:e,timeout:n})=>{const i=`default_${t}`,o=`default_${t}`,s={id:i,spawn:o,...e&&{queued:e}},r={...void 0!==n&&{timeout:n}};return{ns:t,defaultId:i,defaultSpawn:o,defaultSpawnOptions:s,show:C(t)(s)(r),toggle:b(t)(s)(r),hide:D(t)(s),hideAll:M(t)(s),resetAll:J(t),pause:H(t)(s),resume:L(t)(s),exists:F(t)(s),getCount:B(t),isPaused:K(t)(s),getRemaining:$(t)(s)}},z=X({ns:"dialog"}),Q=X({ns:"notification",queued:!0,timeout:3e3});t.actions=f,t.dialog=z,t.dialogical=X,t.exists=F,t.filterCandidates=(t,e,n)=>{const i=e[t]||[];return((...t)=>e=>t.filter(Boolean).reduce((t,e)=>e(t),e))(j,(t=>e=>e.filter(e=>e.spawnOptions.spawn===t.spawn))(n))(i)},t.getCount=B,t.getRemaining=$,t.getTimerProperty=R,t.hide=D,t.hideAll=M,t.hideItem=G,t.isPaused=K,t.notification=Q,t.pause=H,t.performOnItem=q,t.resetAll=J,t.resume=L,t.selectors=g,t.setDomElement=(t,e)=>{e.transitionOptions.domElement=t},t.show=C,t.showItem=async function(t){return await V(t,n),t.transitionOptions.didShow&&await t.transitionOptions.didShow(t),t.transitionOptions.timeout&&t.timer&&await async function(t,e,n){return e.actions.start(()=>G(t),n),R("getResultPromise")}(t,t.timer,t.transitionOptions.timeout),Promise.resolve(t)},t.states=p,t.toggle=b,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=dialogic.js.map
