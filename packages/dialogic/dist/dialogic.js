!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).dialogic={})}(this,function(t){"use strict";const n="show",e="hide",i={className:!0,component:!0,didHide:!0,didShow:!0,hideDelay:!0,hideDuration:!0,hideTimingFunction:!0,showClassName:!0,showDelay:!0,showDuration:!0,showTimingFunction:!0,timeout:!0,transitionClassName:!0,transitions:!0},o=(t,e)=>{const i=t.domElements?t.domElements.domElement:null;if(!i)throw new Error("No DOM element");return new Promise(o=>{const a=i.style,u=window.getComputedStyle(i),d=e===n,c=s({showDuration:t.showDuration,showDelay:t.showDelay,showTimingFunction:t.showTimingFunction,hideDuration:t.hideDuration,hideDelay:t.hideDelay,hideTimingFunction:t.hideTimingFunction,transitions:t.transitions,domElements:t.domElements},d),l=void 0!==c.duration?1e3*c.duration:u?r(u.transitionDuration):0,m=void 0!==c.delay?1e3*c.delay:u?r(u.transitionDelay):0,f=l+m;c.before&&"function"==typeof c.before&&(a.transitionDuration="0ms",a.transitionDelay="0ms",c.before()),(()=>{const n=c.timingFunction||(u?u.transitionTimingFunction:void 0);n&&(a.transitionTimingFunction=n),a.transitionDuration=l+"ms",a.transitionDelay=m+"ms",t.transitionClassName&&i.classList.add(t.transitionClassName),t.showClassName&&(t.showClassElement||i).classList[d?"add":"remove"](t.showClassName);c.transition&&c.transition()})(),setTimeout(()=>{c.after&&"function"==typeof c.after&&c.after(),t.transitionClassName&&i.classList.remove(t.transitionClassName),o()},f)})},r=t=>{const n=parseFloat(t)*(-1===t.indexOf("ms")?1e3:1);return isNaN(n)?0:n},s=(t,n)=>{const[e,i,o,r]=n?[t.showDuration,t.showDelay,t.showTimingFunction,t.transitions?t.transitions.show:void 0]:[t.hideDuration,t.hideDelay,t.hideTimingFunction,t.transitions?t.transitions.hide:void 0];return{duration:e,delay:i,timingFunction:o,...r?r(t.domElements):void 0}};var a=function(t,n){return t(n={exports:{}},n.exports),n.exports}(function(t){!function(){e.SKIP={},e.lift=function(){var t=arguments[0];return o(Array.prototype.slice.call(arguments,1)).map(function(n){return t.apply(void 0,n)})},e.scan=function(t,n,i){var o=i.map(function(i){var o=t(n,i);return o!==e.SKIP&&(n=o),o});return o(n),o},e.merge=o,e.combine=i,e.scanMerge=function(t,n){var e=t.map(function(t){return t[0]}),o=i(function(){var i=arguments[arguments.length-1];return e.forEach(function(e,o){i.indexOf(e)>-1&&(n=t[o][1](n,e()))}),n},e);return o(n),o},e["fantasy-land/of"]=e;var n=!1;function e(t){var n,o=[],s=[];function a(n){return arguments.length&&n!==e.SKIP&&(t=n,r(a)&&(a._changing(),a._state="active",o.forEach(function(n,e){n(s[e](t))}))),t}return a.constructor=e,a._state=arguments.length&&t!==e.SKIP?"active":"pending",a._parents=[],a._changing=function(){r(a)&&(a._state="changing"),o.forEach(function(t){t._changing()})},a._map=function(n,i){var r=i?e():e(n(t));return r._parents.push(a),o.push(r),s.push(n),r},a.map=function(t){return a._map(t,"active"!==a._state)},a.toJSON=function(){return null!=t&&"function"==typeof t.toJSON?t.toJSON():t},a["fantasy-land/map"]=a.map,a["fantasy-land/ap"]=function(t){return i(function(t,n){return t()(n())},[t,a])},a._unregisterChild=function(t){var n=o.indexOf(t);-1!==n&&(o.splice(n,1),s.splice(n,1))},Object.defineProperty(a,"end",{get:function(){return n||((n=e()).map(function(t){return!0===t&&(a._parents.forEach(function(t){t._unregisterChild(a)}),a._state="ended",a._parents.length=o.length=s.length=0),t}),n)}}),a}function i(t,n){var i=n.every(function(t){if(t.constructor!==e)throw new Error("Ensure that each item passed to stream.combine/stream.merge/lift is a stream");return"active"===t._state}),o=i?e(t.apply(null,n.concat([n]))):e(),r=[],s=n.map(function(e){return e._map(function(s){return r.push(e),(i||n.every(function(t){return"pending"!==t._state}))&&(i=!0,o(t.apply(null,n.concat([r]))),r=[]),s},!0)}),a=o.end.map(function(t){!0===t&&(s.forEach(function(t){t.end(!0)}),a.end(!0))});return o}function o(t){return i(function(){return t.map(function(t){return t()})},t)}function r(t){return"pending"===t._state||"active"===t._state||"changing"===t._state}Object.defineProperty(e,"HALT",{get:function(){return n||console.log("HALT is deprecated and has been renamed to SKIP"),n=!0,e.SKIP}}),t.exports=e}()});const u=(t,n)=>{const e=((t,n)=>n.find(n=>n.id===t))(t,n);return n.indexOf(e)},d=(t,n)=>[n,t.id,t.spawn].filter(Boolean).join("-"),c={store:{}},l=t=>({add:(n,e)=>{t(t=>{const i=t.store[e]||[];return t.store[e]=[...i,n],t})},remove:(n,e)=>{t(t=>{const i=t.store[e]||[],o=((t,n)=>{const e=u(t,n);return-1!==e&&n.splice(e,1),n})(n,i);return t.store[e]=o,t})},replace:(n,e,i)=>{t(t=>{const o=t.store[i]||[];if(o){const r=u(n,o);-1!==r&&(o[r]=e,t.store[i]=[...o])}return t})},removeAll:n=>{t(t=>(t.store[n]=[],t))},store:(n,e)=>{t(t=>(t.store[e]=[...n],t))}}),m=t=>({getStore:()=>{return t().store},find:(n,e)=>{const i=t().store[e]||[],o=d(n,e),r=i.find(t=>t.id===o);return r?{just:r}:{nothing:void 0}},getAll:n=>{return t().store[n]||[]},getCount:n=>{return(t().store[n]||[]).length}}),f=a(),p=a.scan((t,n)=>n(t),{...c},f),h={...l(f)},w={...m(p)},g="undefined"!=typeof document,O=()=>{let t,n,e,i,o,r;const s=()=>{g&&(window.clearTimeout(t),t=-1)},a=()=>{g&&(s(),n=(new Date).getTime(),t=window.setTimeout(()=>{i(),o()},e))};return{start:(t,n)=>(i=t,e=n,new Promise((t,n)=>{o=()=>t(),r=()=>n(),a()})),pause:()=>(s(),e-=(new Date).getTime()-n),resume:()=>{if(-1===t)return a()},stop:s,abort:()=>(s(),r&&r()),toString:()=>"Timer"}};let v=0;const y=()=>v===Number.MAX_SAFE_INTEGER?0:v++,_="none",S="hiding",D=t=>{return Object.keys(t).reduce((n,e)=>{const o=t[e];return i[e]?n.transitionOptions[e]=o:n.instanceOptions[e]=o,n},{transitionOptions:{},instanceOptions:{}})},T=t=>n=>e=>(i,o)=>new Promise(r=>{const s={...n,...o},a=d(s,t),{transitionOptions:u,instanceOptions:c}=D(i),l={...e,...u};l.didShow=t=>(i.didShow&&i.didShow(t),r(t)),l.didHide=t=>(i.didHide&&i.didHide(t),r(t));const m=y().toString(),f={spawnOptions:s,transitionOptions:l,instanceTransitionOptions:u,instanceOptions:c,id:a,timer:O(),key:m,transitionState:_},p=w.find(s,t);if(p.just&&!s.queued){const n=p.just,e=n.instanceTransitionOptions,i={...f,instanceTransitionOptions:e};h.replace(n.id,i,t),l.didShow(s.id)}else h.add(f,t)}),E=t=>n=>e=>i=>{const o={...e,...i},r=w.find(o,n);return r.just?t(r.just,n):Promise.resolve()},C=E((t,n)=>t.transitionState!==S?(t.transitionState=S,x(t,n)):Promise.resolve()),b=E((t,n)=>(t&&t.timer&&t.timer.pause(),Promise.resolve())),A=E((t,n)=>(t&&t.timer&&t.timer.resume(),Promise.resolve())),N=t=>()=>(w.getAll(t).forEach(t=>t.timer.abort()),h.removeAll(t),Promise.resolve()),P=(t,n)=>{const{transitionOptions:e}=D(n);return{...t,transitionOptions:{...t.transitionOptions,...e}}},F=t=>n=>(e,i)=>{const o={...n,...i},r=w.getAll(t),s=r.filter(t=>!o.queued&&!t.spawnOptions.queued),a=r.filter(t=>o.queued||t.spawnOptions.queued);if(s.forEach(n=>x(P(n,e),t)),a.length>0){const[n]=a;h.store([n],t),x(P(n,e),t).then(()=>h.removeAll(t))}},j=t=>()=>w.getCount(t),I=(t,n)=>{try{return o({...t.instanceTransitionOptions,...t.transitionOptions},n)}catch(t){throw new Error(`Transition error: ${t}`)}},x=async function(t,n){return t.transitionOptions.timeout&&t.timer.stop(),await I(t,e),t.transitionOptions.didHide&&await t.transitionOptions.didHide(t.spawnOptions.id),h.remove(t.id,n),console.log("after remove"),t.spawnOptions.id},q="notification",H=`default_${q}`,K=`default_${q}`,L={id:H,queued:!0,spawn:K},M=T(q)(L)({timeout:3e3}),J=C(q)(L),$=b(q)(L),k=A(q)(L),z=F(q)(L),B=N(q),G=j(q);var R=Object.freeze({ns:q,defaultId:H,defaultSpawn:K,show:M,hide:J,pause:$,resume:k,hideAll:z,resetAll:B,getCount:G});const X="dialog",Q={id:"default_dialog",spawn:"default_dialog"},U=T(X)(Q)({}),V=C(X)(Q),W=b(X)(Q),Y=A(X)(Q),Z=F(X)(Q),tt=N(X),nt=j(X);var et=Object.freeze({ns:X,defaultId:"default_dialog",defaultSpawn:"default_dialog",show:U,hide:V,pause:W,resume:Y,hideAll:Z,resetAll:tt,getCount:nt});t.actions=h,t.dialog=et,t.filter=(t,n,e)=>{return((t,n)=>t.filter(t=>t.spawnOptions.spawn===n))(((t,n)=>{let e=0;return t.map(t=>({item:t,queueCount:t.spawnOptions.queued?e++:0})).filter(({queueCount:t})=>0===t).map(({item:t})=>t)})(t[e]||[]),n)},t.getCount=j,t.hide=C,t.hideAll=F,t.hideItem=x,t.notification=R,t.pause=b,t.performOnItem=E,t.resetAll=N,t.resetItem=(t,n)=>{t.timer.abort(),h.remove(t.id,n)},t.resume=A,t.selectors=w,t.show=T,t.showItem=async function(t,e){return await I(t,n),t.transitionOptions.didShow&&await t.transitionOptions.didShow(t.spawnOptions.id),t.transitionOptions.timeout&&await async function(t,n,e){return t.timer.start(()=>x(t,e),n)}(t,t.transitionOptions.timeout,e),t.spawnOptions.id},t.states=p,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=dialogic.js.map
