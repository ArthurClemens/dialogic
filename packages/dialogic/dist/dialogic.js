!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).dialogic={})}(this,function(t){"use strict";function n(t,n){return t(n={exports:{}},n.exports),n.exports}for(var e=n(function(t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var e=new Uint8Array(16);t.exports=function(){return n(e),e}}else{var i=new Array(16);t.exports=function(){for(var t,n=0;n<16;n++)0==(3&n)&&(t=4294967296*Math.random()),i[n]=t>>>((3&n)<<3)&255;return i}}}),i=[],o=0;o<256;++o)i[o]=(o+256).toString(16).substr(1);var r=function(t,n){var e=n||0,o=i;return[o[t[e++]],o[t[e++]],o[t[e++]],o[t[e++]],"-",o[t[e++]],o[t[e++]],"-",o[t[e++]],o[t[e++]],"-",o[t[e++]],o[t[e++]],"-",o[t[e++]],o[t[e++]],o[t[e++]],o[t[e++]],o[t[e++]],o[t[e++]]].join("")};var s=function(t,n,i){var o=n&&i||0;"string"==typeof t&&(n="binary"===t?new Array(16):null,t=null);var s=(t=t||{}).random||(t.rng||e)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,n)for(var a=0;a<16;++a)n[o+a]=s[a];return n||r(s)};const a="show",u="hide",d={showDuration:!0,showDelay:!0,showTimingFunction:!0,hideDuration:!0,hideDelay:!0,hideTimingFunction:!0,transitions:!0,transitionClass:!0,showClass:!0,didShow:!0,didHide:!0,timeout:!0},c=(t,n)=>{const e=t.domElements?t.domElements.domElement:null;return e?new Promise(i=>{const o=e.style,r=window.getComputedStyle(e),s=n===a,u=f({showDuration:t.showDuration,showDelay:t.showDelay,showTimingFunction:t.showTimingFunction,hideDuration:t.hideDuration,hideDelay:t.hideDelay,hideTimingFunction:t.hideTimingFunction,transitions:t.transitions,domElements:t.domElements},s),d=void 0!==u.duration?1e3*u.duration:r?l(r.transitionDuration):0,c=void 0!==u.delay?1e3*u.delay:r?l(r.transitionDelay):0,p=d+c;u.before&&"function"==typeof u.before&&(o.transitionDuration="0ms",o.transitionDelay="0ms",u.before()),(()=>{const n=u.timingFunction||(r?r.transitionTimingFunction:void 0);n&&(o.transitionTimingFunction=n),o.transitionDuration=d+"ms",o.transitionDelay=c+"ms",t.transitionClass&&e.classList.add(t.transitionClass),t.showClass&&(t.showClassElement||e).classList[s?"add":"remove"](t.showClass);u.transition&&u.transition()})(),setTimeout(()=>{u.after&&"function"==typeof u.after&&u.after(),t.transitionClass&&e.classList.remove(t.transitionClass),i()},p)}):Promise.reject()},l=t=>{const n=parseFloat(t)*(-1===t.indexOf("ms")?1e3:1);return isNaN(n)?0:n},f=(t,n)=>{const[e,i,o,r]=n?[t.showDuration,t.showDelay,t.showTimingFunction,t.transitions?t.transitions.show:void 0]:[t.hideDuration,t.hideDelay,t.hideTimingFunction,t.transitions?t.transitions.hide:void 0];return{duration:e,delay:i,timingFunction:o,...r?r(t.domElements):void 0}};var p=n(function(t){!function(){e.SKIP={},e.lift=function(){var t=arguments[0];return o(Array.prototype.slice.call(arguments,1)).map(function(n){return t.apply(void 0,n)})},e.scan=function(t,n,i){var o=i.map(function(i){var o=t(n,i);return o!==e.SKIP&&(n=o),o});return o(n),o},e.merge=o,e.combine=i,e.scanMerge=function(t,n){var e=t.map(function(t){return t[0]}),o=i(function(){var i=arguments[arguments.length-1];return e.forEach(function(e,o){i.indexOf(e)>-1&&(n=t[o][1](n,e()))}),n},e);return o(n),o},e["fantasy-land/of"]=e;var n=!1;function e(t){var n,o=[],s=[];function a(n){return arguments.length&&n!==e.SKIP&&(t=n,r(a)&&(a._changing(),a._state="active",o.forEach(function(n,e){n(s[e](t))}))),t}return a.constructor=e,a._state=arguments.length&&t!==e.SKIP?"active":"pending",a._parents=[],a._changing=function(){r(a)&&(a._state="changing"),o.forEach(function(t){t._changing()})},a._map=function(n,i){var r=i?e():e(n(t));return r._parents.push(a),o.push(r),s.push(n),r},a.map=function(t){return a._map(t,"active"!==a._state)},a.toJSON=function(){return null!=t&&"function"==typeof t.toJSON?t.toJSON():t},a["fantasy-land/map"]=a.map,a["fantasy-land/ap"]=function(t){return i(function(t,n){return t()(n())},[t,a])},a._unregisterChild=function(t){var n=o.indexOf(t);-1!==n&&(o.splice(n,1),s.splice(n,1))},Object.defineProperty(a,"end",{get:function(){return n||((n=e()).map(function(t){return!0===t&&(a._parents.forEach(function(t){t._unregisterChild(a)}),a._state="ended",a._parents.length=o.length=s.length=0),t}),n)}}),a}function i(t,n){var i=n.every(function(t){if(t.constructor!==e)throw new Error("Ensure that each item passed to stream.combine/stream.merge/lift is a stream");return"active"===t._state}),o=i?e(t.apply(null,n.concat([n]))):e(),r=[],s=n.map(function(e){return e._map(function(s){return r.push(e),(i||n.every(function(t){return"pending"!==t._state}))&&(i=!0,o(t.apply(null,n.concat([r]))),r=[]),s},!0)}),a=o.end.map(function(t){!0===t&&(s.forEach(function(t){t.end(!0)}),a.end(!0))});return o}function o(t){return i(function(){return t.map(function(t){return t()})},t)}function r(t){return"pending"===t._state||"active"===t._state||"changing"===t._state}Object.defineProperty(e,"HALT",{get:function(){return n||console.log("HALT is deprecated and has been renamed to SKIP"),n=!0,e.SKIP}}),t.exports=e}()});const m=(t,n)=>{const e=((t,n)=>n.find(n=>n.id===t))(t,n);return n.indexOf(e)},h=(t,n)=>[n,t.id,t.spawn].filter(Boolean).join("-"),w={store:{}},g=t=>({add:(n,e)=>{t(t=>{const i=t.store[e]||[];return t.store[e]=[...i,n],t})},remove:(n,e)=>{t(t=>{const i=t.store[e]||[],o=((t,n)=>{const e=m(t,n);return-1!==e&&n.splice(e,1),n})(n,i);return t.store[e]=o,t})},replace:(n,e,i)=>{t(t=>{const o=t.store[i]||[];if(o){const r=m(n,o);-1!==r&&(o[r]=e,t.store[i]=[...o])}return t})},removeAll:n=>{t(t=>(t.store[n]=[],t))},store:(n,e)=>{t(t=>(t.store[e]=[...n],t))}}),y=t=>({find:(n,e)=>{const i=t().store[e]||[],o=h(n,e),r=i.find(t=>t.id===o);return r?{just:r}:{nothing:void 0}},getAll:n=>{return t().store[n]||[]},getCount:n=>{return(t().store[n]||[]).length}}),v=p(),O=p.scan((t,n)=>n(t),{...w},v),_={...g(v)},D={...y(O)},T="undefined"!=typeof document,b=()=>{let t,n,e,i,o,r;const s=()=>{T&&(window.clearTimeout(t),t=-1)},a=()=>{T&&(s(),n=(new Date).getTime(),t=window.setTimeout(()=>{i(),o()},e))};return{start:(t,n)=>(i=t,e=n,new Promise((t,n)=>{o=()=>t(),r=()=>t(),a()})),pause:()=>(s(),e-=(new Date).getTime()-n),resume:()=>{if(-1===t)return a()},stop:s,abort:()=>(s(),r&&r())}},C=t=>{return Object.keys(t).reduce((n,e)=>{const i=t[e];return d[e]?n.transitionOptions[e]=i:n.instanceOptions[e]=i,n},{transitionOptions:{},instanceOptions:{}})},S=(t,n,e)=>(i,o)=>new Promise(r=>{const a={...e,...o},u=h(a,t),{transitionOptions:d,instanceOptions:c}=C(i),l={...n,...d};l.didShow=t=>(i.didShow&&i.didShow(t),r(t)),l.didHide=t=>(i.didHide&&i.didHide(t),r(t));const f=s(),p={spawnOptions:a,transitionOptions:l,instanceTransitionOptions:d,instanceOptions:c,id:u,timer:b(),key:a.queued?f:u},m=D.find(a,t);if(m.just&&!a.queued){const n=m.just,e=n.instanceTransitionOptions,i={...p,instanceTransitionOptions:e};_.replace(n.id,i,t),l.didShow(a.id)}else _.add(p,t)}),A=t=>(n,e)=>i=>{const o={...e,...i},r=D.find(o,n);return r.just?t(r.just,n):Promise.resolve()},P=A((t,n)=>K(t,n)),E=A((t,n)=>(t&&t.timer&&t.timer.pause(),Promise.resolve())),j=A((t,n)=>(t&&t.timer&&t.timer.resume(),Promise.resolve())),x=t=>()=>(D.getAll(t).forEach(t=>t.timer.abort()),_.removeAll(t),Promise.resolve()),F=(t,n)=>{const{transitionOptions:e}=C(n);return{...t,transitionOptions:{...t.transitionOptions,...e}}},I=(t,n)=>(e,i)=>{const o={...n,...i},r=D.getAll(t),s=r.filter(t=>!o.queued&&!t.spawnOptions.queued),a=r.filter(t=>o.queued||t.spawnOptions.queued);if(s.forEach(n=>K(F(n,e),t)),a.length>0){const[n]=a;_.store([n],t),K(F(n,e),t).then(()=>_.removeAll(t))}},q=t=>(t=>D.getCount(t))(t),H=(t,n)=>c({...t.transitionOptions,...t.instanceTransitionOptions},n),K=async function(t,n){return t.transitionOptions.timeout&&t.timer.stop(),await H(t,u),await t.transitionOptions.didHide(t.spawnOptions.id),_.remove(t.id,n),t.spawnOptions.id},L="notification",N=`default_${L}`,R=`default_${L}`,V={id:N,queued:!0,spawn:R},J=S(L,{timeout:3e3},V),M=P(L,V),k=E(L,V),z=j(L,V),$=x(L),B=I(L,V),U=q(L);var G=Object.freeze({ns:L,defaultId:N,defaultSpawn:R,show:J,hide:M,pause:k,resume:z,resetAll:$,hideAll:B,count:U});const Q="dialog",W={id:"default_dialog",spawn:"default_dialog"},X=S(Q,{},W),Y=P(Q,W),Z=E(Q,W),tt=j(Q,W),nt=x(Q),et=I(Q,W),it=q(Q);var ot=Object.freeze({ns:Q,defaultId:"default_dialog",defaultSpawn:"default_dialog",show:X,hide:Y,pause:Z,resume:tt,resetAll:nt,hideAll:et,count:it});t.actions=_,t.count=q,t.dialog=ot,t.filter=(t,n,e)=>{return((t,n)=>t.filter(t=>t.spawnOptions.spawn===n))(((t,n)=>{let e=0;return t.map(t=>({item:t,queueCount:t.spawnOptions.queued?e++:0})).filter(({queueCount:t})=>0===t).map(({item:t})=>t)})(t[e]||[]),n)},t.hide=P,t.hideAll=I,t.hideItem=K,t.notification=G,t.pause=E,t.performOnItem=A,t.resetAll=x,t.resetItem=(t,n)=>{t.timer.abort(),_.remove(t.id,n)},t.resume=j,t.selectors=D,t.show=S,t.showItem=async function(t,n){return await H(t,a),await t.transitionOptions.didShow(t.spawnOptions.id),t.transitionOptions.timeout&&await async function(t,n,e){return t.timer.start(()=>K(t,e),n)}(t,t.transitionOptions.timeout,n),t.spawnOptions.id},t.states=O,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=dialogic.js.map
