!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("mithril/stream")):"function"==typeof define&&define.amd?define(["exports","mithril/stream"],t):t((n=n||self).dialogic={},n.Stream)}(this,(function(n,t){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var i=function(){return(i=Object.assign||function(n){for(var t,i=1,e=arguments.length;i<e;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}).apply(this,arguments)};function e(n,t,i,e){return new(i||(i=Promise))((function(r,o){function u(n){try{s(e.next(n))}catch(n){o(n)}}function a(n){try{s(e.throw(n))}catch(n){o(n)}}function s(n){var t;n.done?r(n.value):(t=n.value,t instanceof i?t:new i((function(n){n(t)}))).then(u,a)}s((e=e.apply(n,t||[])).next())}))}function r(n,t){var i,e,r,o,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,e&&(r=2&o[0]?e.return:o[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,o[1])).done)return r;switch(e=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,e=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(r=u.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){u.label=o[1];break}if(6===o[0]&&u.label<r[1]){u.label=r[1],r=o;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(o);break}r[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(n,u)}catch(n){o=[6,n],e=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function o(){for(var n=0,t=0,i=arguments.length;t<i;t++)n+=arguments[t].length;var e=Array(n),r=0;for(t=0;t<i;t++)for(var o=arguments[t],u=0,a=o.length;u<a;u++,r++)e[r]=o[u];return e}var u=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return function(t){return n.filter(Boolean).reduce((function(n,t){return t(n)}),t)}},a=function(n){var t=n.domElement,i=n.prop,e=document.defaultView;if(e){var r=e.getComputedStyle(t);if(r)return r.getPropertyValue(i)}},s="show",c="hide",f=function(n,t,i){var e=i[t]||{};Object.keys(e).forEach((function(t){var i=e[t].toString();n.style[t]=i}))},d=function(n,t){return n.split(/ /).map((function(n){return n+"-"+t}))},l=function(n,t,i,e){var r;if(t.styles){var u=function(n,t){return("function"==typeof t?t(n):t)||{}}(n,t.styles);f(n,"default",u),e&&function(n){n.style.transitionDuration="0ms"}(n),f(n,i,u)}if(t.className){var a={showStart:d(t.className,"show-start"),showEnd:d(t.className,"show-end"),hideStart:d(t.className,"hide-start"),hideEnd:d(t.className,"hide-end")};!function(n,t){var i;(i=n.classList).remove.apply(i,o(t.showStart,t.showEnd,t.hideStart,t.hideEnd))}(n,a),a&&(r=n.classList).add.apply(r,a[i])}n.scrollTop},m={showStart:{nextStep:"showEnd"},showEnd:{nextStep:void 0},hideStart:{nextStep:"hideEnd"},hideEnd:{nextStep:void 0}},p=function(n,t){var i=n.domElement;if(!i)return Promise.resolve("no domElement");clearTimeout(n.__transitionTimeoutId__);var e=t===s?"showStart":"hideStart";return new Promise((function(t){l(i,n,e,"showStart"===e),setTimeout((function(){var r=m[e].nextStep;if(r){l(i,n,e=r);var o=function(n){var t=a({domElement:n,prop:"transition-duration"}),i=void 0!==t?v(t):0,e=a({domElement:n,prop:"transition-delay"});return i+(void 0!==e?v(e):0)}(i);n.__transitionTimeoutId__=setTimeout(t,o)}}),0)}))},v=function(n){var t=parseFloat(n)*(-1===n.indexOf("ms")?1e3:1);return isNaN(t)?0:t},h=function(n,t){var i=function(n,t){return t.find((function(t){return t.id===n}))}(n,t);return t.indexOf(i)},g=function(n,t){return[t,n.id,n.spawn].filter(Boolean).join("-")},w={initialState:{store:{}},actions:function(n){return{add:function(t,i){n((function(e){var r=e.store[t]||[];return e.store[t]=o(r,[i]),i.timer&&i.timer.states.map((function(){return w.actions(n).refresh()})),e}))},remove:function(t,i){n((function(n){var e=n.store[t]||[],r=function(n,t){var i=h(n,t);return-1!==i&&t.splice(i,1),t}(i,e);return n.store[t]=r,n}))},replace:function(t,i,e){n((function(n){var r=n.store[t]||[];if(r){var u=h(i,r);-1!==u&&(r[u]=e,n.store[t]=o(r))}return n}))},removeAll:function(t){n((function(n){return n.store[t]=[],n}))},store:function(t,i){n((function(n){return n.store[t]=o(i),n}))},refresh:function(){n((function(n){return i({},n)}))}}},selectors:function(n){var t={getStore:function(){return n().store},find:function(t,i){var e=n().store[t]||[],r=g(i,t),o=e.find((function(n){return n.id===r}));return o?{just:o}:{nothing:void 0}},getAll:function(t,i){var e=n().store[t]||[],r=void 0!==i?i.spawn:void 0,o=void 0!==i?i.id:void 0,u=void 0!==r?e.filter((function(n){return n.identityOptions.spawn===r})):e;return void 0!==o?u.filter((function(n){return n.identityOptions.id===o})):u},getCount:function(n,i){return t.getAll(n,i).length}};return t}},y=t(),S=t.scan((function(n,t){return t(n)}),i({},w.initialState),y),O=i({},w.actions(y)),b=i({},w.selectors(S)),P={callback:function(){},isPaused:!1,onAbort:function(){},onDone:function(){},promise:void 0,remaining:void 0,startTime:void 0,timeoutFn:function(){},timerId:void 0},T=function(n){return window.clearTimeout(n.timerId),{timerId:P.timerId}},E=function(n){return i(i({},T(n)),{isPaused:!0,remaining:x(n)})},x=function(n){return 0===n.remaining||void 0===n.remaining?n.remaining:n.remaining-((new Date).getTime()-(n.startTime||0))},k=function(){var n={initialState:P,actions:function(t){return{start:function(e,r){t((function(o){return i(i(i(i({},o),T(o)),function(n,t,e,r){var o=function(){t(),n.onDone(),r()};return i({timeoutFn:o,promise:new Promise((function(t,i){n.onDone=function(){return t()},n.onAbort=function(){return t()}}))},n.isPaused?{}:{startTime:(new Date).getTime(),timerId:window.setTimeout(o,e),remaining:e})}(o,e,r,(function(){return n.actions(t).done()}))),o.isPaused&&E(o))}))},stop:function(){t((function(n){return i(i(i({},n),function(n){return i({},T(n))}(n)),P)}))},pause:function(){t((function(n){return i(i({},n),!n.isPaused&&E(n))}))},resume:function(n){t((function(t){return i(i({},t),t.isPaused&&function(n,t){window.clearTimeout(n.timerId);var i=t?Math.max(n.remaining||0,t):n.remaining;return{startTime:(new Date).getTime(),isPaused:!1,remaining:i,timerId:window.setTimeout(n.timeoutFn,i)}}(t,n))}))},abort:function(){t((function(n){return n.onAbort(),i(i({},n),T(n))}))},done:function(){t((function(n){return P}))},refresh:function(){t((function(n){return i({},n)}))}}},selectors:function(n){return{isPaused:function(){return n().isPaused},getRemaining:function(){var t=n();return t.isPaused?t.remaining:x(t)},getResultPromise:function(){return n().promise}}}},e=t(),r=t.scan((function(n,t){return t(n)}),i({},n.initialState),e);return{states:r,actions:i({},n.actions(e)),selectors:i({},n.selectors(r))}},A=0,j=0,_=1,q=2,I=function(n){return function(t){return void 0!==n.spawn?t.filter((function(t){return t.identityOptions.spawn===n.spawn})):t}},D=function(n){var t=0;return n.map((function(n){return{item:n,queueCount:n.dialogicOptions.queued?t++:0}})).filter((function(n){return 0===n.queueCount})).map((function(n){return n.item}))},H=function(n,t){return void 0===t&&(t={}),{id:t.id||n.id,spawn:t.spawn||n.spawn}},C=function(n,t){void 0===t&&(t={});var e={id:t.dialogic?t.dialogic.id:void 0,spawn:t.dialogic?t.dialogic.spawn:void 0};return{identityOptions:H(n||{},e),dialogicOptions:i(i(i({},n),t.dialogic),{__transitionTimeoutId__:0}),passThroughOptions:function(n){var t=i({},n);return delete t.dialogic,t}(t)}},N=function(n){return function(t){return function(e){void 0===e&&(e={});var r=C(t,e),o=r.identityOptions,u=r.dialogicOptions,a=r.passThroughOptions;return new Promise((function(r){var s={willShow:function(n){return u.willShow&&u.willShow(n),r(n)},willHide:function(n){return u.willHide&&u.willHide(n),r(n)},didShow:function(n){return u.didShow&&u.didShow(n),r(n)},didHide:function(n){return u.didHide&&u.didHide(n),r(n)}},c={ns:n,identityOptions:o,dialogicOptions:u,callbacks:s,passThroughOptions:a,id:g(o,n),timer:u.timeout?k():void 0,key:(A===Number.MAX_VALUE?0:A++).toString(),transitionState:j},f=b.find(n,o);if(f.just&&u.toggle){var d=F(n)(t)(e);return r(d)}if(f.just&&!u.queued){var l=f.just,m=l.dialogicOptions,p=i(i({},c),{key:l.key,transitionState:l.transitionState,dialogicOptions:m});O.replace(n,l.id,p)}else O.add(n,c);r(c)}))}}},F=function(n){return function(t){return function(e){var r=C(t,e),o=r.identityOptions,u=r.dialogicOptions,a=r.passThroughOptions,s=b.find(n,o);if(s.just){var c=s.just,f=i(i({},c),{dialogicOptions:i(i({},c.dialogicOptions),u),passThroughOptions:i(i({},c.passThroughOptions),{passThroughOptions:a})});return O.replace(n,c.id,f),f.transitionState!==q?Y(f):Promise.resolve(f)}return Promise.resolve()}}},R=function(n){return function(t){return function(t){var i=U(n,t).filter((function(n){return!!n.timer}));return i.forEach((function(n){return n.timer&&n.timer.actions.pause()})),Promise.all(i)}}},M=function(n){return function(t){return function(t){var i=t||{},e={id:i.id,spawn:i.spawn},r=U(n,e).filter((function(n){return!!n.timer}));return r.forEach((function(n){return n.timer&&n.timer.actions.resume(i.minimumDuration)})),Promise.all(r)}}},L=function(n,t){return function(i){return function(e){return function(r){var o=function(n){return function(t){return function(i){return b.find(n,H(t,i))}}}(i)(e)(r);return o.just&&o.just&&o.just.timer?o.just.timer.selectors[n]():t}}}},V=L("isPaused",!1),B=L("getRemaining",void 0),G=function(n){return function(t){return function(t){return!!U(n,t).length}}},U=function(n,t){var i=b.getAll(n);return t?u(I(t),function(n){return function(t){return void 0!==n.id?t.filter((function(t){return t.identityOptions.id===n.id})):t}}(t))(i):i},X=function(n){return function(t){return function(t){var i=U(n,t),e=[];return i.forEach((function(n){n.timer&&n.timer.actions.abort(),e.push(n)})),t?e.forEach((function(t){O.remove(n,t.id)})):O.removeAll(n),Promise.resolve(e)}}},z=function(n,t){return i(i({},n),{dialogicOptions:i(i({},n.dialogicOptions),t)})},J=function(n){return function(t){return function(t){var i=t||{},e={id:i.id,spawn:i.spawn},r=U(n,e),o=r.filter((function(n){return!i.queued&&!n.dialogicOptions.queued})),u=r.filter((function(n){return i.queued||n.dialogicOptions.queued})),a=[];if(o.forEach((function(n){return a.push(Y(z(n,i)))})),u.length>0){var s=u[0];O.store(n,[s]),a.push(Y(z(s,i)))}return Promise.all(a)}}},K=function(n){return function(t){return b.getCount(n,t)}},Q=function(n,t){return p(n.dialogicOptions,t)},W=function(n,t,i){return e(this,void 0,void 0,(function(){return r(this,(function(e){return t.actions.start((function(){return Y(n)}),i),[2,L("getResultPromise",void 0)]}))}))},Y=function(n){return e(this,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return n.transitionState=q,n.timer&&n.timer.actions.stop(),n.callbacks.willHide&&n.callbacks.willHide(n),[4,Q(n,c)];case 1:return e.sent(),n.callbacks.didHide&&n.callbacks.didHide(n),t=i({},n),O.remove(n.ns,n.id),[2,Promise.resolve(t)]}}))}))},Z=function(n){var t=n.ns,e=n.queued,r=n.timeout,o="default_"+t,u="default_"+t,a=i(i({id:o,spawn:u},e&&{queued:e}),void 0!==r&&{timeout:r});return{ns:t,defaultId:o,defaultSpawn:u,defaultDialogicOptions:a,show:N(t)(a),hide:F(t)(a),hideAll:J(t)(a),resetAll:X(t)(a),pause:R(t)(a),resume:M(t)(a),exists:G(t)(a),getCount:K(t),isPaused:V(t)(a),getRemaining:B(t)(a)}},$=Z({ns:"dialog"}),nn=Z({ns:"notification",queued:!0,timeout:3e3});n.actions=O,n.dialog=$,n.dialogical=Z,n.exists=G,n.filterCandidates=function(n,t,i){var e=t[n]||[];return 0==e.length?[]:u(I(i),D)(e)},n.getCount=K,n.getRemaining=B,n.getTimerProperty=L,n.hide=F,n.hideAll=J,n.hideItem=Y,n.isPaused=V,n.notification=nn,n.pause=R,n.remaining=function(n){var t,i=void 0,e=!1,r=function(){var o=n.instance.getRemaining();i!==o&&(i=void 0===o?o:n.roundToSeconds?Math.round(Math.max(o,0)/1e3):Math.max(o,0)),n.callback(i),n.instance.exists()?e||(t=window.requestAnimationFrame(r)):(window.cancelAnimationFrame(t),e=!0)};t=window.requestAnimationFrame(r)},n.resetAll=X,n.resume=M,n.selectors=b,n.setDomElement=function(n,t){t.dialogicOptions.domElement=n},n.show=N,n.showItem=function(n){return e(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return n.callbacks.willShow&&n.callbacks.willShow(n),n.transitionState===_?[3,2]:(n.transitionState=_,[4,Q(n,s)]);case 1:t.sent(),t.label=2;case 2:return n.callbacks.didShow&&n.callbacks.didShow(n),n.dialogicOptions.timeout&&n.timer?[4,W(n,n.timer,n.dialogicOptions.timeout)]:[3,4];case 3:t.sent(),t.label=4;case 4:return[2,Promise.resolve(n)]}}))}))},n.states=S,Object.defineProperty(n,"__esModule",{value:!0})}));
