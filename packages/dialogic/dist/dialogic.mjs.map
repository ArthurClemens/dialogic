{"version":3,"file":"dialogic.mjs","sources":["../src/state/store.ts","../src/state/timer.ts","../src/utils.ts","../src/transition.ts","../src/dialogic.ts","../src/dialogical.ts","../src/dialog.ts","../src/notification.ts","../src/remaining.ts"],"sourcesContent":["/* eslint-disable no-param-reassign */\nimport Stream from 'mithril/stream';\n\nimport { Dialogic } from '../index';\n\ntype PatchFn = (state: Dialogic.State) => Dialogic.State;\n\nconst findItem = <T = unknown>(id: string, items: Dialogic.Item<T>[]) =>\n  items.find(item => item.id === id);\n\nconst itemIndex = <T = unknown>(id: string, items: Dialogic.Item<T>[]) => {\n  const item = findItem<T>(id, items);\n  return item ? items.indexOf(item) : -1;\n};\n\nconst removeItem = <T = unknown>(id: string, items: Dialogic.Item<T>[]) => {\n  const index = itemIndex<T>(id, items);\n  if (index !== -1) {\n    items.splice(index, 1);\n  }\n  return items;\n};\n\nexport const createId = (\n  identityOptions: Dialogic.IdentityOptions,\n  ns: string,\n) => [ns, identityOptions.id, identityOptions.spawn].filter(Boolean).join('-');\n\nconst store = {\n  initialState: {\n    store: {},\n  },\n\n  actions: (update: Stream<PatchFn>) => ({\n    /**\n     * Add an item to the end of the list.\n     */\n    add: <T extends unknown = unknown>(ns: string, item: Dialogic.Item<T>) => {\n      update((state: Dialogic.State) => {\n        const items = state.store[ns] || [];\n        state.store[ns] = [...items, item as Dialogic.Item<unknown>];\n        if (item.timer) {\n          // When the timer state updates, refresh the store so that UI can pick up the change\n          item.timer.states.map(() => store.actions(update).refresh());\n        }\n        return state;\n      });\n    },\n\n    /**\n     * Removes the first item with a match on `id`.\n     */\n    remove: (ns: string, id: string) => {\n      update((state: Dialogic.State) => {\n        const items = state.store[ns] || [];\n        const remaining = removeItem(id, items);\n        state.store[ns] = remaining;\n        return state;\n      });\n    },\n\n    /**\n     * Replaces the first item with a match on `id` with a newItem.\n     */\n    replace: <T = unknown>(\n      ns: string,\n      id: string,\n      newItem: Dialogic.Item<T>,\n    ) => {\n      update((state: Dialogic.State) => {\n        const items = state.store[ns] || [];\n        if (items) {\n          const index = itemIndex(id, items);\n          if (index !== -1) {\n            items[index] = newItem as Dialogic.Item<unknown>;\n            state.store[ns] = [...items] as Dialogic.Item<unknown>[];\n          }\n        }\n        return state;\n      });\n    },\n\n    /**\n     * Removes all items within a namespace.\n     */\n    removeAll: (ns: string) => {\n      update((state: Dialogic.State) => {\n        state.store[ns] = [];\n        return state;\n      });\n    },\n\n    /**\n     * Replaces all items within a namespace.\n     */\n    store: <T = unknown>(ns: string, newItems: Dialogic.Item<T>[]) => {\n      update((state: Dialogic.State) => {\n        state.store[ns] = [...(newItems as Dialogic.Item[])];\n        return state;\n      });\n    },\n\n    refresh: () => {\n      update((state: Dialogic.State) => ({\n        ...state,\n      }));\n    },\n  }),\n\n  selectors: (states: Stream<Dialogic.State>) => {\n    const fns = {\n      getStore: () => {\n        const state = states();\n        return state.store;\n      },\n\n      find: <T = unknown>(\n        ns: string,\n        identityOptions: Dialogic.IdentityOptions,\n      ) => {\n        const state = states();\n        const items = state.store[ns] || [];\n        const id = createId(identityOptions, ns);\n        const item = items.find(fitem => fitem.id === id) as Dialogic.Item<T>;\n        return item ? { just: item } : { nothing: undefined };\n      },\n\n      getAll: <T = unknown>(\n        ns: string,\n        identityOptions?: Dialogic.IdentityOptions,\n      ) => {\n        const state = states();\n        const items = (state.store[ns] || []) as Dialogic.Item<T>[];\n        const spawn =\n          identityOptions !== undefined ? identityOptions.spawn : undefined;\n        const id =\n          identityOptions !== undefined ? identityOptions.id : undefined;\n        const itemsBySpawn =\n          spawn !== undefined\n            ? items.filter(fitem => fitem.identityOptions.spawn === spawn)\n            : items;\n        const itemsById =\n          id !== undefined\n            ? itemsBySpawn.filter(item => item.identityOptions.id === id)\n            : itemsBySpawn;\n        return itemsById;\n      },\n\n      getCount: (ns: string, identityOptions?: Dialogic.IdentityOptions) =>\n        fns.getAll(ns, identityOptions).length,\n    };\n\n    return fns;\n  },\n};\n\nconst update: Stream<PatchFn> = Stream<PatchFn>();\n\nexport const states: Dialogic.States = Stream.scan(\n  (state: Dialogic.State, patch: PatchFn) => patch(state),\n  {\n    ...store.initialState,\n  },\n  update,\n);\n\nexport const actions = {\n  ...store.actions(update),\n};\n\nexport const selectors = {\n  ...store.selectors(states),\n};\n\n// states.map(state =>\n//   console.log(JSON.stringify(state, null, 2))\n// );\n","/* eslint-disable no-param-reassign */\n/* eslint-disable @typescript-eslint/no-use-before-define */\nimport Stream from 'mithril/stream';\n\ntype TimerCallback = () => unknown;\ntype TOnFinishFn = () => void;\n\ntype TimerState = {\n  timerId?: number;\n  startTime?: number;\n  remaining: number | undefined;\n  isPaused: boolean;\n  callback: TimerCallback;\n  timeoutFn: () => void;\n  promise?: Promise<unknown>;\n  onDone: TOnFinishFn;\n  onAbort: TOnFinishFn;\n};\n\ntype PatchFn = (state: TimerState) => TimerState;\n\nconst initialState: TimerState = {\n  callback: () => {},\n  isPaused: false,\n  onAbort: () => {},\n  onDone: () => {},\n  promise: undefined,\n  remaining: undefined,\n  startTime: undefined,\n  timeoutFn: () => {},\n  timerId: undefined,\n};\n\nconst appendStartTimer = (\n  state: TimerState,\n  callback: TimerCallback,\n  duration: number,\n  updateState: () => unknown,\n) => {\n  const timeoutFn = () => {\n    callback();\n    state.onDone();\n    updateState();\n  };\n  return {\n    timeoutFn,\n    promise: new Promise<void>(resolve => {\n      state.onDone = () => resolve();\n      state.onAbort = () => resolve();\n    }),\n    ...(state.isPaused\n      ? {}\n      : {\n          startTime: new Date().getTime(),\n          timerId: window.setTimeout(timeoutFn, duration),\n          remaining: duration,\n        }),\n  };\n};\n\nconst appendStopTimeout = (state: TimerState) => {\n  window.clearTimeout(state.timerId);\n  return {\n    timerId: initialState.timerId,\n  };\n};\n\nconst appendStopTimer = (state: TimerState) => ({\n  ...appendStopTimeout(state),\n});\n\nconst appendPauseTimer = (state: TimerState) => ({\n  ...appendStopTimeout(state),\n  isPaused: true,\n  remaining: getRemaining(state),\n});\n\nconst appendResumeTimer = (state: TimerState, minimumDuration?: number) => {\n  window.clearTimeout(state.timerId);\n  const remaining = minimumDuration\n    ? Math.max(state.remaining || 0, minimumDuration)\n    : state.remaining;\n  return {\n    startTime: new Date().getTime(),\n    isPaused: false,\n    remaining,\n    timerId: window.setTimeout(state.timeoutFn, remaining),\n  };\n};\n\nconst getRemaining = (state: TimerState) =>\n  state.remaining === 0 || state.remaining === undefined\n    ? state.remaining\n    : state.remaining - (new Date().getTime() - (state.startTime || 0));\n\nexport const TimerStore = () => {\n  const timer = {\n    initialState,\n    actions: (update: Stream<PatchFn>) => ({\n      /**\n       * Starts the timer\n       * @param {callback} Function Callback function that is called after completion.\n       * @param {duration} Number Timer duration in milliseconds.\n       */\n      start: (callback: TimerCallback, duration: number) => {\n        update((state: TimerState) => ({\n          ...state,\n          ...appendStopTimeout(state),\n          ...appendStartTimer(state, callback, duration, () =>\n            timer.actions(update).done(),\n          ),\n          ...(state.isPaused && appendPauseTimer(state)),\n        }));\n      },\n\n      /**\n       * Stops the timer.\n       */\n      stop: () => {\n        update((state: TimerState) => ({\n          ...state,\n          ...appendStopTimer(state),\n          ...initialState,\n        }));\n      },\n\n      /**\n       * Pauses a running timer.\n       */\n      pause: () => {\n        update((state: TimerState) => ({\n          ...state,\n          ...(!state.isPaused && appendPauseTimer(state)),\n        }));\n      },\n\n      /**\n       * Resumes a paused timer.\n       * @param {minimumDuration} Number Sets the minimum duration.\n       */\n      resume: (minimumDuration?: number) => {\n        update((state: TimerState) => ({\n          ...state,\n          ...(state.isPaused && appendResumeTimer(state, minimumDuration)),\n        }));\n      },\n\n      /**\n       * Aborts and clears a timer.\n       */\n      abort: () => {\n        update((state: TimerState) => {\n          state.onAbort();\n          return {\n            ...state,\n            ...appendStopTimeout(state),\n          };\n        });\n      },\n\n      /**\n       * Updates the current state. Used to get the state for selectors.getRemaining.\n       */\n      refresh: () => {\n        update((state: TimerState) => ({\n          ...state,\n        }));\n      },\n\n      /**\n       * Brings the timer to its initial state.\n       * Used internally.\n       */\n      done: () => {\n        update(() => initialState);\n      },\n    }),\n\n    selectors: (states: Stream<TimerState>) => ({\n      /**\n       * Returns the paused state.\n       */\n      isPaused: () => {\n        const state = states();\n        return state.isPaused;\n      },\n\n      /**\n       * Returns the remaining duration in milliseconds.\n       */\n      getRemaining: () => {\n        const state = states();\n        return state.isPaused ? state.remaining : getRemaining(state);\n      },\n\n      /**\n       * The promise that is handled when the timer is done or canceled.\n       */\n      getResultPromise: () => {\n        const state = states();\n        return state.promise;\n      },\n    }),\n  };\n\n  const update: Stream<PatchFn> = Stream<PatchFn>();\n\n  const states = Stream.scan(\n    (state: TimerState, patch: PatchFn) => patch(state),\n    {\n      ...timer.initialState,\n    },\n    update,\n  );\n\n  const actions = {\n    ...timer.actions(update),\n  };\n\n  const selectors = {\n    ...timer.selectors(states),\n  };\n\n  // states.map(state =>\n  //   console.log(JSON.stringify(state, null, 2))\n  // );\n\n  return {\n    states,\n    actions,\n    selectors,\n  };\n};\n\nexport type Timer = ReturnType<typeof TimerStore>;\n","export const isClient = typeof document !== 'undefined';\nexport const isServer = !isClient;\n\ntype Fn = (args: any) => any;\n\nexport const pipe = (...fns: Fn[]) => (x: any) =>\n  fns.filter(Boolean).reduce((y, f) => f(y), x);\n\nexport const getStyleValue = ({\n  domElement,\n  prop,\n}: {\n  domElement: HTMLElement;\n  prop: string;\n}) => {\n  const defaultView = document.defaultView;\n  if (defaultView) {\n    const style = defaultView.getComputedStyle(domElement);\n    if (style) {\n      return style.getPropertyValue(prop);\n    }\n  }\n};\n","import { getStyleValue } from './utils';\n\nexport const MODE = {\n  SHOW: 'show',\n  HIDE: 'hide',\n};\n\nexport type TransitionStylesFn = (domElement: HTMLElement) => TransitionStyles;\n\nexport type TransitionStyles = {\n  default?: Partial<CSSStyleDeclaration>;\n  showStart?: Partial<CSSStyleDeclaration>;\n  showEnd?: Partial<CSSStyleDeclaration>;\n  hideStart?: Partial<CSSStyleDeclaration>;\n  hideEnd?: Partial<CSSStyleDeclaration>;\n};\n\ntype TransitionProps = {\n  domElement?: HTMLElement;\n  className?: string;\n  styles?: TransitionStyles | TransitionStylesFn;\n  __transitionTimeoutId__?: number;\n};\n\ntype TransitionClassNames = {\n  [key: string]: string[];\n  showStart: string[];\n  showEnd: string[];\n  hideStart: string[];\n  hideEnd: string[];\n};\n\ntype TransitionStep = 'showStart' | 'showEnd' | 'hideStart' | 'hideEnd';\ntype TransitionStyleState = 'default' | TransitionStep;\n\ntype KeyValue = { [key: string]: string };\n\nconst removeTransitionClassNames = (\n  domElement: HTMLElement,\n  transitionClassNames: TransitionClassNames,\n) =>\n  domElement.classList.remove(\n    ...transitionClassNames.showStart,\n    ...transitionClassNames.showEnd,\n    ...transitionClassNames.hideStart,\n    ...transitionClassNames.hideEnd,\n  );\n\nconst applyTransitionStyles = (\n  domElement: HTMLElement,\n  step: TransitionStyleState,\n  styles: TransitionStyles,\n) => {\n  const transitionStyle = styles[step] as CSSStyleDeclaration;\n  if (transitionStyle) {\n    Object.keys(transitionStyle).forEach((key: string) => {\n      // Workaround for error \"getPropertyValue is not a function\"\n      const value = ((transitionStyle as unknown) as KeyValue)[key];\n      // eslint-disable-next-line no-param-reassign\n      ((domElement.style as unknown) as KeyValue)[key] = value;\n    });\n  }\n};\n\nconst applyNoDurationTransitionStyle = (domElement: HTMLElement) => {\n  // eslint-disable-next-line no-param-reassign\n  domElement.style.transitionDuration = '0ms';\n};\n\nconst getTransitionStyles = (\n  domElement: HTMLElement,\n  styles: TransitionStyles | TransitionStylesFn,\n) => (typeof styles === 'function' ? styles(domElement) : styles) || {};\n\nconst createClassList = (className: string, step: string) =>\n  className.split(/ /).map((n: string) => `${n}-${step}`);\n\nconst applyStylesForState = (\n  domElement: HTMLElement,\n  props: TransitionProps,\n  step: TransitionStep,\n  isEnterStep?: boolean,\n) => {\n  if (props.styles) {\n    const styles = getTransitionStyles(domElement, props.styles);\n    applyTransitionStyles(domElement, 'default', styles);\n    if (isEnterStep) {\n      applyNoDurationTransitionStyle(domElement);\n    }\n    applyTransitionStyles(domElement, step, styles);\n  }\n\n  if (props.className) {\n    const transitionClassNames: TransitionClassNames = {\n      showStart: createClassList(props.className, 'show-start'),\n      showEnd: createClassList(props.className, 'show-end'),\n      hideStart: createClassList(props.className, 'hide-start'),\n      hideEnd: createClassList(props.className, 'hide-end'),\n    };\n    removeTransitionClassNames(domElement, transitionClassNames);\n    if (transitionClassNames) {\n      domElement.classList.add(...transitionClassNames[step]);\n    }\n  }\n\n  // reflow\n  // eslint-disable-next-line no-unused-expressions\n  domElement.scrollTop;\n};\n\nconst styleDurationToMs = (durationStr: string) => {\n  const parsed =\n    parseFloat(durationStr) * (durationStr.indexOf('ms') === -1 ? 1000 : 1);\n  return Number.isNaN(parsed) ? 0 : parsed;\n};\n\nconst getDuration = (domElement: HTMLElement) => {\n  const durationStyleValue = getStyleValue({\n    domElement,\n    prop: 'transition-duration',\n  });\n  const durationValue =\n    durationStyleValue !== undefined\n      ? styleDurationToMs(durationStyleValue)\n      : 0;\n  const delayStyleValue = getStyleValue({\n    domElement,\n    prop: 'transition-delay',\n  });\n  const delayValue =\n    delayStyleValue !== undefined ? styleDurationToMs(delayStyleValue) : 0;\n  return durationValue + delayValue;\n};\n\ntype Step = {\n  nextStep?: TransitionStep;\n};\n\ntype Steps = {\n  showStart: Step;\n  showEnd: Step;\n  hideStart: Step;\n  hideEnd: Step;\n};\n\nconst steps: Steps = {\n  showStart: {\n    nextStep: 'showEnd',\n  },\n  showEnd: {\n    nextStep: undefined,\n  },\n  hideStart: {\n    nextStep: 'hideEnd',\n  },\n  hideEnd: {\n    nextStep: undefined,\n  },\n};\n\nexport const transition = (props: TransitionProps, mode?: string) => {\n  const { domElement } = props;\n  if (!domElement) {\n    return Promise.resolve('no domElement');\n  }\n  clearTimeout(props.__transitionTimeoutId__);\n\n  let currentStep: TransitionStep =\n    mode === MODE.SHOW ? 'showStart' : 'hideStart';\n\n  return new Promise(resolve => {\n    applyStylesForState(\n      domElement,\n      props,\n      currentStep,\n      currentStep === 'showStart',\n    );\n\n    setTimeout(() => {\n      const { nextStep } = steps[currentStep];\n      if (nextStep) {\n        currentStep = nextStep;\n        applyStylesForState(domElement, props, currentStep);\n        // addEventListener sometimes hangs this function because it never finishes\n        // Using setTimeout instead of addEventListener gives more consistent results\n        const duration = getDuration(domElement);\n        // eslint-disable-next-line no-param-reassign\n        props.__transitionTimeoutId__ = window.setTimeout(resolve, duration);\n      }\n    }, 0);\n  });\n};\n","/* eslint-disable no-plusplus */\nimport { Dialogic } from './index';\nimport { actions, createId, selectors } from './state/store';\nimport { Timer, TimerStore } from './state/timer';\nimport { MODE, transition } from './transition';\nimport { pipe } from './utils';\n\nexport { actions, selectors, states } from './state/store';\n\nconst localState = {\n  uid: 0,\n};\n\nconst getUid = () => {\n  if (localState.uid === Number.MAX_VALUE) {\n    localState.uid = 0;\n  } else {\n    localState.uid += 1;\n  }\n  return localState.uid;\n};\n\nenum TransitionStates {\n  Default,\n  Displaying,\n  Hiding,\n}\n\nconst getMaybeItem = <T = unknown>(ns: string) => (\n  defaultDialogicOptions: Dialogic.DefaultDialogicOptions,\n) => (identityOptions?: Dialogic.IdentityOptions) =>\n  selectors.find<T>(\n    ns,\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    getMergedIdentityOptions(defaultDialogicOptions, identityOptions),\n  );\n\nconst filterBySpawn = <T = unknown>(\n  identityOptions: Dialogic.IdentityOptions,\n) => (items: Dialogic.Item<T>[]) =>\n  identityOptions.spawn !== undefined\n    ? items.filter(item => item.identityOptions.spawn === identityOptions.spawn)\n    : items;\n\nconst filterById = <T = unknown>(identityOptions: Dialogic.IdentityOptions) => (\n  items: Dialogic.Item<T>[],\n) =>\n  identityOptions.id !== undefined\n    ? items.filter(item => item.identityOptions.id === identityOptions.id)\n    : items;\n\n/**\n * Gets a list of all non-queued items.\n * From the queued items only the first item is listed.\n * */\nconst filterFirstInQueue = <T = unknown>(nsItems: Dialogic.Item<T>[]) => {\n  let queuedCount = 0;\n  return nsItems\n    .map(item => ({\n      item,\n      queueCount: item.dialogicOptions.queued ? queuedCount++ : 0,\n    }))\n    .filter(({ queueCount }) => queueCount === 0)\n    .map(({ item }) => item);\n};\n\nexport const filterCandidates = (\n  ns: string,\n  items: Dialogic.NamespaceStore,\n  identityOptions: Dialogic.IdentityOptions,\n): Dialogic.Item[] => {\n  const nsItems = (items[ns] || []) as Dialogic.Item[];\n  if (nsItems.length === 0) {\n    return [];\n  }\n  return pipe(filterBySpawn(identityOptions), filterFirstInQueue)(nsItems);\n};\n\ntype TGetPassThroughOptions = <T = unknown>(options: Dialogic.Options<T>) => T;\n\nconst getPassThroughOptions: TGetPassThroughOptions = options => {\n  const copy = {\n    ...options,\n  };\n  delete copy.dialogic;\n  return copy;\n};\n\nconst getMergedIdentityOptions = (\n  defaultDialogicOptions: Dialogic.DefaultDialogicOptions,\n  identityOptions: Dialogic.IdentityOptions = {},\n) =>\n  ({\n    id: identityOptions.id || defaultDialogicOptions.id,\n    spawn: identityOptions.spawn || defaultDialogicOptions.spawn,\n  } as Dialogic.IdentityOptions);\n\nconst handleOptions = <T = unknown>(\n  defaultDialogicOptions: Dialogic.DefaultDialogicOptions,\n  options: Dialogic.Options<T> = {} as T,\n) => {\n  const identityOptions = {\n    id: options.dialogic ? options.dialogic.id : undefined,\n    spawn: options.dialogic ? options.dialogic.spawn : undefined,\n  };\n  const mergedIdentityOptions = getMergedIdentityOptions(\n    defaultDialogicOptions || ({} as Dialogic.DefaultDialogicOptions),\n    identityOptions,\n  );\n\n  const dialogicOptions: Dialogic.DialogicOptions<T> = {\n    ...defaultDialogicOptions,\n    ...options.dialogic,\n    __transitionTimeoutId__: 0,\n  };\n\n  const passThroughOptions = getPassThroughOptions(options);\n\n  return {\n    identityOptions: mergedIdentityOptions,\n    dialogicOptions,\n    passThroughOptions,\n  };\n};\n\nconst createInstance = (ns: string) => (\n  defaultDialogicOptions: Dialogic.DefaultDialogicOptions,\n) => <T = unknown>(options?: Dialogic.Options<T>) => {\n  const {\n    identityOptions,\n    dialogicOptions,\n    passThroughOptions,\n  } = handleOptions(defaultDialogicOptions, options);\n\n  // eslint-disable-next-line consistent-return\n  return new Promise<Dialogic.Item<T>>(resolve => {\n    const callbacks: Dialogic.Callbacks<T> = {\n      willShow: (item: Dialogic.Item<T>) => {\n        if (dialogicOptions.willShow) {\n          dialogicOptions.willShow(item);\n        }\n        return resolve(item);\n      },\n      willHide: (item: Dialogic.Item<T>) => {\n        if (dialogicOptions.willHide) {\n          dialogicOptions.willHide(item);\n        }\n        return resolve(item);\n      },\n      didShow: (item: Dialogic.Item<T>) => {\n        if (dialogicOptions.didShow) {\n          dialogicOptions.didShow(item);\n        }\n        return resolve(item);\n      },\n      didHide: (item: Dialogic.Item<T>) => {\n        if (dialogicOptions.didHide) {\n          dialogicOptions.didHide(item);\n        }\n        return resolve(item);\n      },\n    };\n\n    const item: Dialogic.Item<T> = {\n      ns,\n      identityOptions,\n      dialogicOptions,\n      callbacks,\n      passThroughOptions,\n      id: createId(identityOptions, ns),\n      timer: dialogicOptions.timeout ? TimerStore() : undefined, // when timeout is undefined or 0\n      key: getUid().toString(), // Uniquely identify each item for keyed display\n      transitionState: TransitionStates.Default,\n    };\n\n    const maybeExistingItem: Dialogic.MaybeItem<T> = selectors.find<T>(\n      ns,\n      identityOptions,\n    );\n\n    const existingItem = maybeExistingItem.just;\n\n    if (existingItem && dialogicOptions.toggle) {\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      hide(ns)(defaultDialogicOptions)<T>(options);\n      return resolve(existingItem);\n    }\n\n    if (existingItem && !dialogicOptions.queued) {\n      const replacingItem = {\n        ...item,\n        key: existingItem.key,\n        transitionState: existingItem.transitionState,\n        dialogicOptions: existingItem.dialogicOptions, // Preserve dialogicOptions\n      };\n      actions.replace(ns, existingItem.id, replacingItem as Dialogic.Item<T>);\n    } else {\n      actions.add<T>(ns, item);\n      // This will instantiate and draw the instance\n      // The instance will call `showDialog` in `onMount`\n    }\n\n    resolve(item);\n  });\n};\n\nexport const show = createInstance;\n\nexport const hide = (ns: string) => (\n  defaultDialogicOptions: Dialogic.DefaultDialogicOptions,\n) => <T = unknown>(options?: Dialogic.Options<T>) => {\n  const {\n    identityOptions,\n    dialogicOptions,\n    passThroughOptions,\n  } = handleOptions(defaultDialogicOptions, options);\n  const maybeExistingItem: Dialogic.MaybeItem<T> = selectors.find<T>(\n    ns,\n    identityOptions,\n  );\n  const existingItem = maybeExistingItem.just;\n  if (existingItem) {\n    const item: Dialogic.Item<T> = {\n      ...existingItem,\n      dialogicOptions: {\n        ...existingItem.dialogicOptions,\n        ...dialogicOptions,\n      },\n      passThroughOptions: {\n        ...existingItem.passThroughOptions,\n        passThroughOptions,\n      },\n    };\n    actions.replace<T>(ns, existingItem.id, item);\n    if (item.transitionState !== TransitionStates.Hiding) {\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      return hideItem<T>(item);\n    }\n    return Promise.resolve(item);\n  }\n  return Promise.resolve({\n    ns,\n    id: identityOptions.id,\n  } as Dialogic.Item<T>);\n};\n\nexport const pause = (ns: string) => (\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  defaultDialogicOptions: Dialogic.DefaultDialogicOptions,\n) => <T = unknown>(identityOptions?: Dialogic.IdentityOptions) => {\n  // eslint-disable-next-line @typescript-eslint/no-use-before-define\n  const validItems = getValidItems<T>(ns, identityOptions).filter(\n    item => !!item.timer,\n  );\n  validItems.forEach((item: Dialogic.Item<T>) => {\n    if (item.timer) {\n      item.timer.actions.pause();\n    }\n  });\n  return Promise.all(validItems);\n};\n\nexport const resume = (ns: string) => (\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  defaultDialogicOptions: Dialogic.DefaultDialogicOptions,\n) => <T = unknown>(commandOptions?: Dialogic.CommandOptions) => {\n  const options = commandOptions || {};\n  const identityOptions = {\n    id: options.id,\n    spawn: options.spawn,\n  };\n  // eslint-disable-next-line @typescript-eslint/no-use-before-define\n  const validItems = getValidItems<T>(ns, identityOptions).filter(\n    item => !!item.timer,\n  );\n  validItems.forEach((item: Dialogic.Item<T>) => {\n    if (item.timer) {\n      item.timer.actions.resume(options.minimumDuration);\n    }\n  });\n  return Promise.all(validItems);\n};\n\nconst getTimerSelectors = <T = unknown>(\n  ns: string,\n  defaultDialogicOptions: Dialogic.DefaultDialogicOptions,\n  identityOptions?: Dialogic.IdentityOptions,\n) => {\n  const maybeItem: Dialogic.MaybeItem<T> = getMaybeItem<T>(ns)(\n    defaultDialogicOptions,\n  )(identityOptions);\n  return maybeItem?.just?.timer?.selectors;\n};\n\nexport const isPaused = (ns: string) => (\n  defaultDialogicOptions: Dialogic.DefaultDialogicOptions,\n) => (identityOptions?: Dialogic.IdentityOptions) =>\n  getTimerSelectors(ns, defaultDialogicOptions, identityOptions)?.isPaused() ||\n  false;\n\nexport const getRemaining = (ns: string) => (\n  defaultDialogicOptions: Dialogic.DefaultDialogicOptions,\n) => (identityOptions?: Dialogic.IdentityOptions) =>\n  getTimerSelectors(\n    ns,\n    defaultDialogicOptions,\n    identityOptions,\n  )?.getRemaining() || undefined;\n\nexport const exists = (ns: string) => (\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  defaultDialogicOptions: Dialogic.DefaultDialogicOptions,\n) => (identityOptions?: Dialogic.IdentityOptions) =>\n  // eslint-disable-next-line @typescript-eslint/no-use-before-define\n  !!getValidItems(ns, identityOptions).length;\n\nconst getValidItems = <T = unknown>(\n  ns: string,\n  identityOptions?: Dialogic.IdentityOptions,\n) => {\n  const allItems = selectors.getAll<T>(ns);\n  let validItems: Dialogic.Item<T>[];\n  if (identityOptions) {\n    validItems = pipe(\n      filterBySpawn(identityOptions),\n      filterById(identityOptions),\n    )(allItems);\n  } else {\n    validItems = allItems;\n  }\n  return validItems;\n};\n\nexport const resetAll = (ns: string) => (\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  defaultDialogicOptions: Dialogic.DefaultDialogicOptions,\n) => (identityOptions?: Dialogic.IdentityOptions) => {\n  const validItems = getValidItems(ns, identityOptions);\n  const items: Dialogic.Item[] = [];\n\n  validItems.forEach((item: Dialogic.Item) => {\n    if (item.timer) {\n      item.timer.actions.abort();\n    }\n    items.push(item);\n  });\n\n  if (identityOptions) {\n    items.forEach((item: Dialogic.Item) => {\n      actions.remove(ns, item.id);\n    });\n  } else {\n    actions.removeAll(ns);\n  }\n\n  return Promise.resolve(items);\n};\n\nconst getOverridingTransitionOptions = <T = unknown>(\n  item: Dialogic.Item<T>,\n  dialogicOptions: Dialogic.DialogicOptions<T>,\n) => ({\n  ...item,\n  dialogicOptions: {\n    ...item.dialogicOptions,\n    ...dialogicOptions,\n  },\n});\n\n/**\n * Triggers a `hideItem` for each item in the store.\n * Queued items: will trigger `hideItem` only for the first item, then reset the store.\n * Optional `dialogicOptions` may be passed with specific transition options. This comes in handy when all items should hide in the same way.\n */\nexport const hideAll = (ns: string) => (\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  defaultDialogicOptions: Dialogic.DefaultDialogicOptions,\n) => <T = unknown>(dialogicOptions?: Dialogic.DialogicOptions<T>) => {\n  const options = dialogicOptions || {};\n  const identityOptions: Dialogic.IdentityOptions = {\n    id: options.id,\n    spawn: options.spawn,\n  };\n  const validItems = getValidItems<T>(ns, identityOptions);\n  const regularItems = validItems.filter(\n    (item: Dialogic.Item<T>) => !options.queued && !item.dialogicOptions.queued,\n  );\n  const queuedItems = validItems.filter(\n    (item: Dialogic.Item<T>) => options.queued || item.dialogicOptions.queued,\n  );\n\n  const items = [];\n\n  regularItems.forEach((item: Dialogic.Item<T>) =>\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    items.push(hideItem(getOverridingTransitionOptions<T>(item, options))),\n  );\n\n  if (queuedItems.length > 0) {\n    const [current] = queuedItems;\n    // Make sure that any remaining items don't suddenly appear\n    actions.store(ns, [current]);\n    // Transition the current item\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    items.push(hideItem(getOverridingTransitionOptions<T>(current, options)));\n  }\n\n  return Promise.all(items);\n};\n\nexport const getCount = (ns: string) => (\n  identityOptions?: Dialogic.IdentityOptions,\n) => selectors.getCount(ns, identityOptions);\n\nconst transitionItem = <T = unknown>(item: Dialogic.Item<T>, mode: string) =>\n  transition(item.dialogicOptions, mode);\n\nconst getResultPromise = <T = unknown>() => (ns: string) => (\n  defaultDialogicOptions: Dialogic.DefaultDialogicOptions,\n) => (identityOptions?: Dialogic.IdentityOptions) => {\n  const maybeItem: Dialogic.MaybeItem<T> = getMaybeItem<T>(ns)(\n    defaultDialogicOptions,\n  )(identityOptions);\n  if (maybeItem.just) {\n    if (maybeItem.just && maybeItem.just.timer) {\n      return maybeItem.just.timer.selectors.getResultPromise();\n    }\n    return undefined;\n  }\n  return undefined;\n};\n\nconst deferredHideItem = async <T = unknown>(\n  item: Dialogic.Item<T>,\n  timer: Timer,\n  timeout: number,\n) => {\n  // eslint-disable-next-line @typescript-eslint/no-use-before-define\n  timer.actions.start(() => hideItem(item), timeout);\n  return getResultPromise<T>();\n};\n\nexport const showItem: Dialogic.InitiateItemTransitionFn = async <T = unknown>(\n  item: Dialogic.Item<T>,\n) => {\n  if (item.callbacks.willShow) {\n    item.callbacks.willShow(item);\n  }\n  if (item.transitionState !== TransitionStates.Displaying) {\n    // eslint-disable-next-line no-param-reassign\n    item.transitionState = TransitionStates.Displaying;\n    await transitionItem(item, MODE.SHOW);\n  }\n  if (item.callbacks.didShow) {\n    item.callbacks.didShow(item);\n  }\n  if (item.dialogicOptions.timeout && item.timer) {\n    await deferredHideItem(item, item.timer, item.dialogicOptions.timeout);\n  }\n  return Promise.resolve(item);\n};\n\n/**\n * Hides an item. Any timer will be stopped. Any callbacks will be called.\n * @returns A Promise with (a copy of) the data of the removed item.\n */\nexport const hideItem = async <T = unknown>(\n  item: Dialogic.Item<T>,\n): Promise<Dialogic.Item<T>> => {\n  // eslint-disable-next-line no-param-reassign\n  item.transitionState = TransitionStates.Hiding;\n  // Stop any running timer\n  if (item.timer) {\n    item.timer.actions.stop();\n  }\n  if (item.callbacks.willHide) {\n    item.callbacks.willHide(item);\n  }\n  await transitionItem(item, MODE.HIDE);\n  if (item.callbacks.didHide) {\n    item.callbacks.didHide(item);\n  }\n  const copy = {\n    ...item,\n  };\n  actions.remove(item.ns, item.id);\n  return Promise.resolve(copy);\n};\n\nexport const setDomElement = <T = unknown>(\n  domElement: HTMLElement,\n  item: Dialogic.Item<T>,\n) => {\n  // eslint-disable-next-line no-param-reassign\n  item.dialogicOptions.domElement = domElement;\n};\n","import {\n  show,\n  hide,\n  hideAll,\n  resetAll,\n  getCount,\n  pause,\n  resume,\n  isPaused,\n  getRemaining,\n  exists,\n} from './dialogic';\nimport { Dialogic } from './index';\n\nexport const dialogical = ({\n  ns,\n  queued,\n  timeout,\n}: {\n  ns: string;\n  queued?: boolean;\n  timeout?: number;\n}) => {\n  const defaultId = `default_${ns}`;\n  const defaultSpawn = `default_${ns}`;\n  const defaultDialogicOptions: Dialogic.DefaultDialogicOptions = {\n    id: defaultId,\n    spawn: defaultSpawn,\n    ...(queued && { queued }),\n    ...(timeout !== undefined && { timeout }),\n  };\n\n  return {\n    // Identification\n    ns,\n    defaultId,\n    defaultSpawn,\n    // Configuration\n    defaultDialogicOptions,\n    // Commands\n    show: show(ns)(defaultDialogicOptions),\n    hide: hide(ns)(defaultDialogicOptions),\n    hideAll: hideAll(ns)(defaultDialogicOptions),\n    resetAll: resetAll(ns)(defaultDialogicOptions),\n    // Timer commands\n    pause: pause(ns)(defaultDialogicOptions),\n    resume: resume(ns)(defaultDialogicOptions),\n    // State\n    exists: exists(ns)(defaultDialogicOptions),\n    getCount: getCount(ns),\n    // Timer state\n    isPaused: isPaused(ns)(defaultDialogicOptions),\n    getRemaining: getRemaining(ns)(defaultDialogicOptions),\n  };\n};\n","import { dialogical } from './dialogical';\n\nexport const dialog = dialogical({ ns: 'dialog' });\n","import { dialogical } from './dialogical';\n\nexport const notification = dialogical({\n  ns: 'notification',\n  queued: true,\n  timeout: 3000,\n});\n","/**\n * Utility script that uses an animation frame to pass the current remaining value\n * (which is utilized when setting `timeout`).\n */\n\nimport { DialogicInstance } from './types';\n\ntype RemainingProps = {\n  /**\n   * Dialogic instance: notification, dialog, or custom.\n   */\n  instance: DialogicInstance;\n\n  id?: string;\n  spawn?: string;\n\n  /**\n   * Set to true to return seconds instead of milliseconds.\n   */\n  roundToSeconds?: boolean;\n\n  /**\n   * Returns the remaining time as milliseconds. Returns `undefined` when the timer is not running (before and after the timer runs).\n   */\n  callback: (displayValue: number | undefined) => unknown;\n};\n\nexport const remaining = (props: RemainingProps) => {\n  let displayValue: number | undefined;\n  let reqId: number;\n  let isCanceled: boolean = false;\n  const identity = {\n    id: props.id,\n    spawn: props.spawn,\n  };\n\n  const update = () => {\n    const remainingValue = props.instance.getRemaining(identity);\n    if (displayValue !== remainingValue) {\n      displayValue =\n        remainingValue === undefined\n          ? remainingValue\n          : props.roundToSeconds\n          ? Math.round(Math.max(remainingValue, 0) / 1000)\n          : Math.max(remainingValue, 0);\n    }\n    props.callback(displayValue);\n    if (!props.instance.exists(identity)) {\n      window.cancelAnimationFrame(reqId);\n      isCanceled = true;\n    } else if (!isCanceled) {\n      reqId = window.requestAnimationFrame(update);\n    }\n  };\n  reqId = window.requestAnimationFrame(update);\n};\n"],"names":["getRemaining"],"mappings":"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"}